<<<<<<< HEAD
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#1a3b5a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>PS Pro - Or√ßamentos Inteligentes</title>
    <link rel="manifest" href="manifest.json">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/dexie@3.2.4/dist/dexie.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root {
            --azul: #1a3b5a;
            --azul-medio: #2a5580;
            --amarelo: #f7c026;
            --amarelo-hover: #e5af1e;
            --branco: #ffffff;
            --cinza-bg: #f5f7fa;
            --cinza-borda: #e0e5eb;
            --cinza-texto: #6b7280;
            --verde: #22c55e;
            --vermelho: #ef4444;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Poppins', sans-serif;
            background: var(--cinza-bg);
            color: var(--azul);
            min-height: 100vh;
            padding-bottom: 90px;
        }
        .header {
            background: linear-gradient(135deg, var(--azul) 0%, var(--azul-medio) 100%);
            padding: 20px;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .header-content { display: flex; align-items: center; justify-content: space-between; }
        .logo { display: flex; align-items: center; gap: 12px; }
        .logo-icon {
            width: 45px; height: 45px;
            background: var(--branco);
            border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            font-weight: 800; font-size: 14px;
            position: relative;
        }
        .logo-icon span:first-child { color: var(--azul); position: absolute; top: 6px; left: 8px; font-size: 18px; }
        .logo-icon span:last-child { color: var(--amarelo); position: absolute; bottom: 4px; right: 6px; font-size: 16px; }
        .logo-text { color: var(--branco); }
        .logo-text h1 { font-size: 22px; font-weight: 700; }
        .logo-text span { font-size: 11px; opacity: 0.85; }
        .header-btn {
            width: 42px; height: 42px;
            background: rgba(255,255,255,0.15);
            border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            color: var(--branco);
            cursor: pointer;
            border: none;
        }
        .bottom-nav {
            position: fixed;
            bottom: 0; left: 0; right: 0;
            background: var(--branco);
            padding: 10px 15px 25px;
            display: flex;
            justify-content: space-around;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.1);
            z-index: 1000;
            border-radius: 24px 24px 0 0;
        }
        .nav-item {
            display: flex; flex-direction: column; align-items: center; gap: 4px;
            padding: 8px 14px;
            border-radius: 14px;
            cursor: pointer;
            color: var(--cinza-texto);
            transition: all 0.2s;
        }
        .nav-item.active {
            background: linear-gradient(135deg, var(--azul) 0%, var(--azul-medio) 100%);
            color: var(--branco);
        }
        .nav-item svg { width: 22px; height: 22px; }
        .nav-item span { font-size: 10px; font-weight: 500; }
        .main { padding: 20px; max-width: 500px; margin: 0 auto; }
        .page { display: none; animation: fadeIn 0.3s; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .card {
            background: var(--branco);
            border-radius: 16px;
            padding: 18px;
            margin-bottom: 14px;
            box-shadow: 0 2px 10px rgba(26,59,90,0.08);
        }
        .card-title { font-size: 15px; font-weight: 600; margin-bottom: 14px; }
        .stats-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 16px; }
        .stat-card {
            background: var(--branco);
            border-radius: 14px;
            padding: 16px;
            box-shadow: 0 2px 10px rgba(26,59,90,0.08);
        }
        .stat-card.highlight {
            background: linear-gradient(135deg, var(--azul) 0%, var(--azul-medio) 100%);
            color: var(--branco);
        }
        .stat-card.success { border-left: 4px solid var(--verde); }
        .stat-card.warning { border-left: 4px solid var(--amarelo); }
        .stat-value { font-size: 22px; font-weight: 700; }
        .stat-label { font-size: 11px; color: var(--cinza-texto); margin-top: 4px; }
        .stat-card.highlight .stat-label { color: rgba(255,255,255,0.8); }
        .btn {
            display: flex; align-items: center; justify-content: center; gap: 8px;
            padding: 14px 20px;
            border-radius: 12px;
            font-family: 'Poppins', sans-serif;
            font-size: 14px; font-weight: 600;
            border: none;
            cursor: pointer;
            width: 100%;
            transition: all 0.2s;
        }
        .btn-primary { background: var(--amarelo); color: var(--azul); }
        .btn-primary:hover { background: var(--amarelo-hover); transform: translateY(-2px); }
        .btn-secondary { background: var(--azul); color: var(--branco); }
        .btn-outline { background: transparent; border: 2px solid var(--azul); color: var(--azul); }
        .btn-sm { padding: 10px 16px; font-size: 13px; width: auto; }
        .form-group { margin-bottom: 14px; }
        .form-label { display: block; font-size: 12px; font-weight: 500; margin-bottom: 6px; }
        .form-input, .form-select {
            width: 100%;
            padding: 12px 14px;
            border: 2px solid var(--cinza-borda);
            border-radius: 10px;
            font-family: 'Poppins', sans-serif;
            font-size: 14px;
            background: var(--branco);
        }
        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--amarelo);
        }
        .form-row { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
        .list-item {
            display: flex; align-items: center;
            padding: 14px;
            background: var(--branco);
            border-radius: 12px;
            margin-bottom: 10px;
            box-shadow: 0 2px 8px rgba(26,59,90,0.06);
            cursor: pointer;
            transition: all 0.2s;
        }
        .list-item:hover { transform: translateX(4px); }
        .list-icon {
            width: 42px; height: 42px;
            border-radius: 10px;
            background: var(--cinza-bg);
            display: flex; align-items: center; justify-content: center;
            margin-right: 12px;
            color: var(--azul);
        }
        .list-info { flex: 1; }
        .list-title { font-size: 14px; font-weight: 600; }
        .list-sub { font-size: 11px; color: var(--cinza-texto); }
        .list-value { font-size: 14px; font-weight: 700; }
        .badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 20px;
            font-size: 10px;
            font-weight: 600;
            margin-top: 4px;
        }
        .badge-pending { background: rgba(247,192,38,0.2); color: #b8860b; }
        .badge-approved { background: rgba(34,197,94,0.2); color: #16a34a; }
        .badge-rejected { background: rgba(239,68,68,0.2); color: #dc2626; }
        .section-title {
            font-size: 16px; font-weight: 700;
            margin-bottom: 14px;
            display: flex; align-items: center; justify-content: space-between;
        }
        .section-title a { font-size: 12px; color: var(--amarelo); text-decoration: none; }
        .quick-actions { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 16px; }
        .quick-action {
            background: var(--branco);
            border-radius: 14px;
            padding: 18px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 2px 10px rgba(26,59,90,0.08);
        }
        .quick-action:hover { transform: translateY(-3px); box-shadow: 0 4px 15px rgba(26,59,90,0.12); }
        .quick-action svg { width: 28px; height: 28px; color: var(--amarelo); margin-bottom: 8px; }
        .quick-action span { display: block; font-size: 12px; font-weight: 600; }
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(26,59,90,0.6);
            backdrop-filter: blur(4px);
            display: none;
            align-items: center; justify-content: center;
            z-index: 2000;
            padding: 20px;
        }
        .modal-overlay.active { display: flex; }
        .modal {
            background: var(--branco);
            border-radius: 16px;
            width: 100%;
            max-width: 420px;
            max-height: 85vh;
            overflow-y: auto;
            animation: modalIn 0.3s;
        }
        @keyframes modalIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .modal-header {
            padding: 18px;
            border-bottom: 1px solid var(--cinza-borda);
            display: flex; align-items: center; justify-content: space-between;
        }
        .modal-title { font-size: 16px; font-weight: 700; }
        .modal-close {
            width: 32px; height: 32px;
            border-radius: 8px;
            background: var(--cinza-bg);
            display: flex; align-items: center; justify-content: center;
            cursor: pointer;
            border: none;
        }
        .modal-body { padding: 18px; }
        .modal-footer {
            padding: 14px 18px;
            border-top: 1px solid var(--cinza-borda);
            display: flex; gap: 10px;
        }
        .modal-footer .btn { flex: 1; }
        .search-box { position: relative; margin-bottom: 14px; }
        .search-box input { padding-left: 40px; }
        .search-box svg { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--cinza-texto); width: 18px; height: 18px; }
        .empty-state { text-align: center; padding: 40px 20px; }
        .empty-state svg { width: 60px; height: 60px; color: var(--cinza-borda); margin-bottom: 14px; }
        .empty-state h3 { font-size: 16px; margin-bottom: 6px; }
        .empty-state p { font-size: 13px; color: var(--cinza-texto); margin-bottom: 16px; }
        .top-item {
            display: flex; align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid var(--cinza-bg);
        }
        .top-item:last-child { border-bottom: none; }
        .top-rank {
            width: 26px; height: 26px;
            border-radius: 8px;
            background: var(--amarelo);
            color: var(--azul);
            display: flex; align-items: center; justify-content: center;
            font-weight: 700; font-size: 12px;
            margin-right: 10px;
        }
        .top-info { flex: 1; }
        .top-name { font-size: 13px; font-weight: 600; }
        .top-stats { font-size: 11px; color: var(--cinza-texto); }
        .top-value { text-align: right; }
        .top-total { font-size: 13px; font-weight: 700; }
        .top-rate { font-size: 10px; color: var(--verde); }
        .orc-item {
            display: flex; align-items: center;
            padding: 10px;
            background: var(--cinza-bg);
            border-radius: 10px;
            margin-bottom: 8px;
        }
        .orc-item-info { flex: 1; }
        .orc-item-name { font-size: 13px; font-weight: 600; }
        .orc-item-det { font-size: 11px; color: var(--cinza-texto); }
        .orc-item-val { font-size: 14px; font-weight: 700; margin-right: 10px; }
        .orc-item-del {
            width: 28px; height: 28px;
            border-radius: 6px;
            background: rgba(239,68,68,0.1);
            color: var(--vermelho);
            display: flex; align-items: center; justify-content: center;
            cursor: pointer;
            border: none;
        }
        .orc-total {
            background: linear-gradient(135deg, var(--azul) 0%, var(--azul-medio) 100%);
            border-radius: 14px;
            padding: 18px;
            color: var(--branco);
            margin-top: 14px;
        }
        .orc-total-label { font-size: 12px; opacity: 0.8; }
        .orc-total-value { font-size: 28px; font-weight: 800; }
        .toast {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--azul);
            color: var(--branco);
            padding: 12px 20px;
            border-radius: 10px;
            font-size: 13px;
            z-index: 3000;
            opacity: 0;
            transition: all 0.3s;
        }
        .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }
        .autocomplete-wrapper { position: relative; }
        .autocomplete-list {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--branco);
            border: 2px solid var(--cinza-borda);
            border-top: none;
            border-radius: 0 0 10px 10px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 100;
            display: none;
        }
        .autocomplete-list.show { display: block; }
        .autocomplete-item {
            padding: 10px 14px;
            cursor: pointer;
            border-bottom: 1px solid var(--cinza-bg);
            font-size: 13px;
        }
        .autocomplete-item:hover { background: var(--cinza-bg); }
        .autocomplete-item:last-child { border-bottom: none; }
        .autocomplete-item small { color: var(--cinza-texto); display: block; font-size: 11px; }
        .orc-item-edit {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .orc-item-edit input {
            width: 60px;
            padding: 4px 8px;
            border: 1px solid var(--cinza-borda);
            border-radius: 6px;
            font-size: 12px;
            text-align: center;
        }
        .orc-item-ambiente {
            background: var(--azul);
            color: var(--branco);
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            margin: 12px 0 8px 0;
        }
        .orc-item-ambiente:first-child { margin-top: 0; }
        .filters-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 12px;
        }
        .filter-group { }
        .filter-label {
            display: block;
            font-size: 11px;
            font-weight: 500;
            color: var(--cinza-texto);
            margin-bottom: 4px;
        }
        .filter-select {
            padding: 8px 10px;
            font-size: 12px;
            border-radius: 8px;
        }
        .filters-summary {
            font-size: 12px;
            color: var(--cinza-texto);
            margin-bottom: 12px;
            padding: 8px 12px;
            background: var(--cinza-bg);
            border-radius: 8px;
            display: none;
        }
        .filters-summary.show { display: block; }
        .filters-summary strong { color: var(--azul); }
        /* Remover setinhas dos inputs num√©ricos */
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type="number"] {
            -moz-appearance: textfield;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon"><span>P</span><span>S</span></div>
                <div class="logo-text">
                    <h1>PS Pro</h1>
                    <span>Or√ßamentos Inteligentes</span>
                </div>
            </div>
            <button class="header-btn" onclick="showPage('config')">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20">
                    <circle cx="12" cy="12" r="3"></circle>
                    <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                </svg>
            </button>
        </div>
    </header>

    <main class="main">
        <!-- DASHBOARD -->
        <div id="page-dashboard" class="page active">
            <div class="quick-actions">
                <div class="quick-action" onclick="openModal('modal-cliente')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                        <circle cx="12" cy="7" r="4"></circle>
                        <line x1="12" y1="11" x2="12" y2="17"></line>
                        <line x1="9" y1="14" x2="15" y2="14"></line>
                    </svg>
                    <span>Novo Cliente</span>
                </div>
                <div class="quick-action" onclick="openModal('modal-orcamento')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                        <line x1="12" y1="18" x2="12" y2="12"></line>
                        <line x1="9" y1="15" x2="15" y2="15"></line>
                    </svg>
                    <span>Novo Or√ßamento</span>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card highlight" onclick="filterOrcamentos('todos')" style="cursor:pointer;">
                    <div class="stat-value" id="stat-total">0</div>
                    <div class="stat-label">Or√ßamentos</div>
                </div>
                <div class="stat-card success" onclick="filterOrcamentos('fechado')" style="cursor:pointer;">
                    <div class="stat-value" id="stat-fechados">0</div>
                    <div class="stat-label">‚úÖ Fechados</div>
                </div>
                <div class="stat-card warning" onclick="filterOrcamentos('pendente')" style="cursor:pointer;">
                    <div class="stat-value" id="stat-pendentes">0</div>
                    <div class="stat-label">üü° Pendentes</div>
                </div>
                <div class="stat-card" style="border-left: 4px solid var(--vermelho); cursor:pointer;" onclick="filterOrcamentos('recusado')">
                    <div class="stat-value" id="stat-recusados">0</div>
                    <div class="stat-label">‚ùå Recusados</div>
                </div>
            </div>

            <div class="stat-card highlight" style="margin-bottom:16px; cursor:pointer;" onclick="filterOrcamentos('fechado')">
                <div class="stat-label">üí∞ Valor Total Fechado</div>
                <div class="stat-value" id="stat-valor">R$ 0</div>
            </div>

            <div class="section-title">
                Or√ßamentos Pendentes
                <a href="#" onclick="showPage('orcamentos');return false;">Ver todos</a>
            </div>
            <div id="ultimos-orc"></div>
        </div>

        <!-- SERVI√áOS -->
        <div id="page-servicos" class="page">
            <div class="section-title">
                Meus Servi√ßos
                <button class="btn btn-primary btn-sm" onclick="openModal('modal-servico')">+ Novo</button>
            </div>
            <div class="search-box">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                <input type="text" class="form-input" placeholder="Buscar servi√ßo..." id="search-serv" oninput="filterList('servicos')">
            </div>
            <div id="servicos-list"></div>
        </div>

        <!-- CLIENTES -->
        <div id="page-clientes" class="page">
            <div class="section-title">
                Meus Clientes
                <button class="btn btn-primary btn-sm" onclick="openModal('modal-cliente')">+ Novo</button>
            </div>
            <div class="search-box">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                <input type="text" class="form-input" placeholder="Buscar cliente..." id="search-cli" oninput="filterList('clientes')">
            </div>
            <div id="clientes-list"></div>
        </div>

        <!-- OR√áAMENTOS -->
        <div id="page-orcamentos" class="page">
            <div class="section-title">
                Meus Or√ßamentos
                <button class="btn btn-primary btn-sm" onclick="openModal('modal-orcamento')">+ Novo</button>
            </div>
            <div class="search-box">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                <input type="text" class="form-input" placeholder="Buscar or√ßamento..." id="search-orc" oninput="applyOrcFilters()">
            </div>
            <div class="filters-row">
                <div class="filter-group">
                    <label class="filter-label">Status</label>
                    <select class="form-select filter-select" id="filter-status" onchange="applyOrcFilters()">
                        <option value="">Todos</option>
                        <option value="pendente">üü° Pendente</option>
                        <option value="fechado">‚úÖ Fechado</option>
                        <option value="recusado">‚ùå Recusado</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Per√≠odo</label>
                    <select class="form-select filter-select" id="filter-periodo" onchange="applyOrcFilters()">
                        <option value="">Todo per√≠odo</option>
                        <option value="7">√öltimos 7 dias</option>
                        <option value="15">√öltimos 15 dias</option>
                        <option value="30">√öltimos 30 dias</option>
                        <option value="60">√öltimos 60 dias</option>
                        <option value="90">√öltimos 90 dias</option>
                    </select>
                </div>
            </div>
            <div class="filters-summary" id="filters-summary"></div>
            <div id="orcamentos-list"></div>
        </div>

        <!-- CONFIGURA√á√ïES -->
        <div id="page-config" class="page">
            <div class="section-title">Meu Perfil</div>
            <div class="card">
                <form id="form-perfil">
                    <div class="form-group">
                        <label class="form-label">Nome / Raz√£o Social</label>
                        <input type="text" class="form-input" id="perfil-nome" placeholder="Seu nome ou empresa">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">CPF / CNPJ</label>
                            <input type="text" class="form-input" id="perfil-doc" placeholder="000.000.000-00">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Telefone</label>
                            <input type="tel" class="form-input" id="perfil-tel" placeholder="(00) 00000-0000">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-input" id="perfil-email" placeholder="seu@email.com">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">CEP</label>
                            <input type="text" class="form-input" id="perfil-cep" placeholder="00000-000" maxlength="9" oninput="buscarCEPPerfil(this.value)">
                        </div>
                        <div class="form-group">
                            <label class="form-label">N√∫mero</label>
                            <input type="text" class="form-input" id="perfil-num" placeholder="N¬∫">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Endere√ßo</label>
                        <input type="text" class="form-input" id="perfil-end" placeholder="Rua, Bairro, Cidade - UF">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Complemento</label>
                            <input type="text" class="form-input" id="perfil-compl" placeholder="Sala, Apto...">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Validade Or√ßamentos (dias)</label>
                            <input type="number" class="form-input" id="perfil-val" value="15">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Formas de Pagamento Aceitas</label>
                        <input type="text" class="form-input" id="perfil-pagamento" placeholder="Ex: Pix, Dinheiro, Cart√£o, Transfer√™ncia">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Observa√ß√µes Padr√£o dos Or√ßamentos</label>
                        <textarea class="form-input" id="perfil-obs" rows="4" placeholder="Ex: Material n√£o incluso. Prazo de execu√ß√£o a combinar. Garantia de 1 ano..."></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Salvar Perfil</button>
                </form>
            </div>
        </div>
    </main>

    <nav class="bottom-nav">
        <div class="nav-item active" data-page="dashboard" onclick="showPage('dashboard')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>
            <span>In√≠cio</span>
        </div>
        <div class="nav-item" data-page="servicos" onclick="showPage('servicos')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path></svg>
            <span>Servi√ßos</span>
        </div>
        <div class="nav-item" data-page="clientes" onclick="showPage('clientes')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
            <span>Clientes</span>
        </div>
        <div class="nav-item" data-page="orcamentos" onclick="showPage('orcamentos')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line></svg>
            <span>Or√ßamentos</span>
        </div>
    </nav>

    <!-- Modal Servi√ßo -->
    <div class="modal-overlay" id="modal-servico">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title" id="title-servico">Novo Servi√ßo</div>
                <button class="modal-close" onclick="closeModal('modal-servico')">‚úï</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="servico-id">
                <div class="form-group">
                    <label class="form-label">Nome do Servi√ßo</label>
                    <input type="text" class="form-input" id="servico-nome" placeholder="Ex: Pintura interna">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Unidade</label>
                        <select class="form-select" id="servico-un">
                            <option value="m¬≤">m¬≤</option>
                            <option value="m">m linear</option>
                            <option value="un">unidade</option>
                            <option value="h">hora</option>
                            <option value="di√°ria">di√°ria</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Pre√ßo (R$)</label>
                        <input type="text" class="form-input" id="servico-preco" placeholder="0,00" oninput="this.value = maskMoeda(this.value)">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Descri√ß√£o (opcional)</label>
                    <input type="text" class="form-input" id="servico-desc" placeholder="Detalhes">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('modal-servico')">Cancelar</button>
                <button class="btn btn-primary" onclick="saveServico()">Salvar</button>
            </div>
        </div>
    </div>

    <!-- Modal Cliente -->
    <div class="modal-overlay" id="modal-cliente">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title" id="title-cliente">Novo Cliente</div>
                <button class="modal-close" onclick="closeModal('modal-cliente')">‚úï</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="cliente-id">
                <div class="form-group">
                    <label class="form-label">Nome Completo</label>
                    <input type="text" class="form-input" id="cliente-nome" placeholder="Nome">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">CPF/CNPJ</label>
                        <input type="text" class="form-input" id="cliente-doc" placeholder="000.000.000-00">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Telefone</label>
                        <input type="tel" class="form-input" id="cliente-tel" placeholder="(00) 00000-0000">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" id="cliente-email" placeholder="email@email.com">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">CEP</label>
                        <input type="text" class="form-input" id="cliente-cep" placeholder="00000-000" maxlength="9" oninput="buscarCEP(this.value)">
                    </div>
                    <div class="form-group">
                        <label class="form-label">N√∫mero</label>
                        <input type="text" class="form-input" id="cliente-num" placeholder="N¬∫">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Endere√ßo da Obra</label>
                    <input type="text" class="form-input" id="cliente-end" placeholder="Rua, Bairro, Cidade - UF">
                </div>
                <div class="form-group">
                    <label class="form-label">Complemento</label>
                    <input type="text" class="form-input" id="cliente-compl" placeholder="Apto, Bloco, etc.">
                </div>
                <div class="form-group">
                    <label class="form-label">Observa√ß√µes</label>
                    <input type="text" class="form-input" id="cliente-obs" placeholder="Anota√ß√µes">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('modal-cliente')">Cancelar</button>
                <button class="btn btn-primary" onclick="saveCliente()">Salvar</button>
            </div>
        </div>
    </div>

    <!-- Modal Or√ßamento -->
    <div class="modal-overlay" id="modal-orcamento">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title" id="modal-orc-title">Novo Or√ßamento</div>
                <button class="modal-close" onclick="closeModal('modal-orcamento')">‚úï</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="orc-id">
                <div class="form-group">
                    <label class="form-label">Cliente</label>
                    <div class="autocomplete-wrapper">
                        <input type="text" class="form-input" id="orc-cliente-search" placeholder="Digite para buscar cliente..." oninput="searchClientes(this.value)">
                        <input type="hidden" id="orc-cliente">
                        <div class="autocomplete-list" id="cliente-autocomplete"></div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">T√≠tulo do Or√ßamento</label>
                    <input type="text" class="form-input" id="orc-titulo" placeholder="Ex: Pintura apartamento 302">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Ambiente / Local</label>
                    <input type="text" class="form-input" id="orc-ambiente" placeholder="Ex: Sala, Quarto 1, Cozinha...">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Buscar Servi√ßo</label>
                    <div class="autocomplete-wrapper">
                        <input type="text" class="form-input" id="orc-serv-search" placeholder="Digite para buscar servi√ßo..." oninput="searchServicos(this.value)">
                        <input type="hidden" id="orc-serv-sel">
                        <div class="autocomplete-list" id="servico-autocomplete"></div>
                    </div>
                </div>
                <div class="form-row" style="grid-template-columns: 1fr 1fr 1fr;">
                    <div class="form-group">
                        <label class="form-label">Qtd</label>
                        <input type="text" class="form-input" id="orc-qtd" placeholder="0,00" oninput="this.value = maskMoeda(this.value)">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Pre√ßo Unit.</label>
                        <input type="text" class="form-input" id="orc-preco-unit" placeholder="0,00" oninput="this.value = maskMoeda(this.value)">
                    </div>
                    <div class="form-group">
                        <label class="form-label">&nbsp;</label>
                        <button type="button" class="btn btn-secondary" onclick="addItemOrc()">+ Add</button>
                    </div>
                </div>
                <div id="orc-itens"></div>
                <div class="orc-total">
                    <div class="orc-total-label">Total do Or√ßamento</div>
                    <div class="orc-total-value" id="orc-total">R$ 0,00</div>
                </div>
                <div class="form-group" style="margin-top:16px;">
                    <label class="form-label">Forma de Pagamento</label>
                    <input type="text" class="form-input" id="orc-pagamento" placeholder="Ex: 50% entrada + 50% na entrega">
                </div>
                <div class="form-group">
                    <label class="form-label">Observa√ß√µes</label>
                    <textarea class="form-input" id="orc-obs" rows="3" placeholder="Condi√ß√µes, prazos, garantias..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('modal-orcamento')">Cancelar</button>
                <button class="btn btn-primary" onclick="saveOrcamento()">Salvar</button>
            </div>
        </div>
    </div>

    <!-- Modal Detalhes -->
    <div class="modal-overlay" id="modal-det">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">Detalhes do Or√ßamento</div>
                <button class="modal-close" onclick="closeModal('modal-det')">‚úï</button>
            </div>
            <div class="modal-body" id="det-content"></div>
            <div class="modal-footer" style="flex-wrap:wrap;gap:8px;">
                <button class="btn btn-outline btn-sm" style="flex:1;min-width:70px;" onclick="setStatus('pendente')">üü° Pendente</button>
                <button class="btn btn-outline btn-sm" style="flex:1;min-width:70px;" onclick="setStatus('fechado')">‚úÖ Fechado</button>
                <button class="btn btn-outline btn-sm" style="flex:1;min-width:70px;" onclick="setStatus('recusado')">‚ùå Recusado</button>
                <button class="btn btn-secondary" style="width:100%;" onclick="editOrcamento()">‚úèÔ∏è Editar Or√ßamento</button>
                <button class="btn btn-primary" style="width:100%;" onclick="exportPDF()">üìÑ Exportar PDF</button>
            </div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script>
        const db = new Dexie('PSProDB');
        db.version(1).stores({
            perfil: '++id',
            clientes: '++id,nome',
            servicos: '++id,nome',
            orcamentos: '++id,clienteId,status,data'
        });

        let orcItens = [];
        let currentOrcId = null;

        function showPage(p) {
            document.querySelectorAll('.page').forEach(x => x.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(x => x.classList.remove('active'));
            document.getElementById('page-' + p).classList.add('active');
            document.querySelector(`.nav-item[data-page="${p}"]`)?.classList.add('active');
            if (p === 'dashboard') loadDashboard();
            if (p === 'servicos') loadServicos();
            if (p === 'clientes') loadClientes();
            if (p === 'orcamentos') loadOrcamentos();
            if (p === 'config') loadPerfil();
        }

        let isEditingOrc = false;

        async function openModal(id) {
            document.getElementById(id).classList.add('active');
            if (id === 'modal-orcamento' && !isEditingOrc) {
                orcItens = [];
                renderOrcItens();
                loadSelects();
                
                // Pr√©-preencher observa√ß√µes e pagamento do perfil
                const pArr = await db.perfil.toArray();
                if (pArr[0]) {
                    document.getElementById('orc-obs').value = pArr[0].obs || '';
                    document.getElementById('orc-pagamento').value = pArr[0].pagamento || '';
                }
            }
            isEditingOrc = false;
        }

        function closeModal(id) {
            document.getElementById(id).classList.remove('active');
            if (id === 'modal-servico') {
                document.getElementById('servico-id').value = '';
                document.getElementById('servico-nome').value = '';
                document.getElementById('servico-preco').value = '';
                document.getElementById('servico-desc').value = '';
                document.getElementById('title-servico').textContent = 'Novo Servi√ßo';
            }
            if (id === 'modal-cliente') {
                document.getElementById('cliente-id').value = '';
                document.getElementById('cliente-nome').value = '';
                document.getElementById('cliente-doc').value = '';
                document.getElementById('cliente-tel').value = '';
                document.getElementById('cliente-email').value = '';
                document.getElementById('cliente-cep').value = '';
                document.getElementById('cliente-num').value = '';
                document.getElementById('cliente-end').value = '';
                document.getElementById('cliente-compl').value = '';
                document.getElementById('cliente-obs').value = '';
                document.getElementById('title-cliente').textContent = 'Novo Cliente';
            }
            if (id === 'modal-orcamento') {
                document.getElementById('orc-id').value = '';
                document.getElementById('orc-titulo').value = '';
                document.getElementById('orc-qtd').value = '';
                document.getElementById('orc-cliente').value = '';
                document.getElementById('orc-cliente-search').value = '';
                document.getElementById('orc-serv-search').value = '';
                document.getElementById('orc-serv-sel').value = '';
                document.getElementById('orc-preco-unit').value = '';
                document.getElementById('orc-ambiente').value = '';
                document.getElementById('orc-pagamento').value = '';
                document.getElementById('orc-obs').value = '';
                document.getElementById('modal-orc-title').textContent = 'Novo Or√ßamento';
                orcItens = [];
                selectedServico = null;
                renderOrcItens();
            }
        }

        function toast(msg) {
            const t = document.getElementById('toast');
            t.textContent = msg;
            t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 2500);
        }

        // PERFIL
        async function loadPerfil() {
            const p = await db.perfil.toArray();
            if (p[0]) {
                document.getElementById('perfil-nome').value = p[0].nome || '';
                document.getElementById('perfil-doc').value = p[0].doc || '';
                document.getElementById('perfil-tel').value = p[0].tel || '';
                document.getElementById('perfil-email').value = p[0].email || '';
                document.getElementById('perfil-cep').value = p[0].cep || '';
                document.getElementById('perfil-num').value = p[0].num || '';
                document.getElementById('perfil-end').value = p[0].end || '';
                document.getElementById('perfil-compl').value = p[0].compl || '';
                document.getElementById('perfil-val').value = p[0].val || 15;
                document.getElementById('perfil-pagamento').value = p[0].pagamento || '';
                document.getElementById('perfil-obs').value = p[0].obs || '';
            }
        }

        document.getElementById('form-perfil').addEventListener('submit', async e => {
            e.preventDefault();
            
            const num = document.getElementById('perfil-num').value;
            const compl = document.getElementById('perfil-compl').value;
            let end = document.getElementById('perfil-end').value;
            
            // Monta endere√ßo completo para exibi√ß√£o
            let endCompleto = end;
            if (num && !end.includes(', ' + num)) {
                endCompleto = end.replace(/,/, ', ' + num + ',');
            }
            if (compl) {
                endCompleto += ' - ' + compl;
            }
            
            const data = {
                nome: document.getElementById('perfil-nome').value,
                doc: document.getElementById('perfil-doc').value,
                tel: document.getElementById('perfil-tel').value,
                email: document.getElementById('perfil-email').value,
                cep: document.getElementById('perfil-cep').value,
                num: num,
                end: endCompleto,
                compl: compl,
                val: document.getElementById('perfil-val').value,
                pagamento: document.getElementById('perfil-pagamento').value,
                obs: document.getElementById('perfil-obs').value
            };
            
            const ex = await db.perfil.toArray();
            if (ex[0]) await db.perfil.update(ex[0].id, data);
            else await db.perfil.add(data);
            
            toast('Perfil salvo!');
            showPage('dashboard');
        });

        // SERVI√áOS
        async function loadServicos() {
            const s = await db.servicos.toArray();
            const c = document.getElementById('servicos-list');
            if (!s.length) {
                c.innerHTML = '<div class="empty-state"><p>Nenhum servi√ßo cadastrado</p><button class="btn btn-primary" style="max-width:180px;margin:0 auto;" onclick="openModal(\'modal-servico\')">Cadastrar</button></div>';
                return;
            }
            c.innerHTML = s.map(x => `
                <div class="list-item" onclick="editServico(${x.id})">
                    <div class="list-icon"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path></svg></div>
                    <div class="list-info">
                        <div class="list-title">${x.nome}</div>
                        <div class="list-sub">${x.desc || ''}</div>
                    </div>
                    <div class="list-value">R$ ${numberToMoeda(x.preco)}/${x.un}</div>
                </div>
            `).join('');
        }

        async function editServico(id) {
            const s = await db.servicos.get(id);
            document.getElementById('servico-id').value = s.id;
            document.getElementById('servico-nome').value = s.nome;
            document.getElementById('servico-un').value = s.un;
            document.getElementById('servico-preco').value = numberToMoeda(s.preco);
            document.getElementById('servico-desc').value = s.desc || '';
            document.getElementById('title-servico').textContent = 'Editar Servi√ßo';
            openModal('modal-servico');
        }

        async function saveServico() {
            const id = document.getElementById('servico-id').value;
            const data = {
                nome: document.getElementById('servico-nome').value,
                un: document.getElementById('servico-un').value,
                preco: moedaToNumber(document.getElementById('servico-preco').value),
                desc: document.getElementById('servico-desc').value
            };
            if (!data.nome || !data.preco) { toast('Preencha nome e pre√ßo'); return; }
            if (id) await db.servicos.update(parseInt(id), data);
            else await db.servicos.add(data);
            toast('Servi√ßo salvo!');
            closeModal('modal-servico');
            loadServicos();
        }

        // CLIENTES
        async function loadClientes() {
            const c = await db.clientes.toArray();
            const el = document.getElementById('clientes-list');
            if (!c.length) {
                el.innerHTML = '<div class="empty-state"><p>Nenhum cliente cadastrado</p><button class="btn btn-primary" style="max-width:180px;margin:0 auto;" onclick="openModal(\'modal-cliente\')">Cadastrar</button></div>';
                return;
            }
            el.innerHTML = c.map(x => `
                <div class="list-item" onclick="editCliente(${x.id})">
                    <div class="list-icon"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg></div>
                    <div class="list-info">
                        <div class="list-title">${x.nome}</div>
                        <div class="list-sub">${x.tel || ''}</div>
                    </div>
                </div>
            `).join('');
        }

        async function editCliente(id) {
            const c = await db.clientes.get(id);
            document.getElementById('cliente-id').value = c.id;
            document.getElementById('cliente-nome').value = c.nome;
            document.getElementById('cliente-doc').value = c.doc || '';
            document.getElementById('cliente-tel').value = c.tel || '';
            document.getElementById('cliente-email').value = c.email || '';
            document.getElementById('cliente-cep').value = c.cep || '';
            document.getElementById('cliente-num').value = c.num || '';
            document.getElementById('cliente-end').value = c.end || '';
            document.getElementById('cliente-compl').value = c.compl || '';
            document.getElementById('cliente-obs').value = c.obs || '';
            document.getElementById('title-cliente').textContent = 'Editar Cliente';
            openModal('modal-cliente');
        }

        async function saveCliente() {
            const id = document.getElementById('cliente-id').value;
            const num = document.getElementById('cliente-num').value;
            const compl = document.getElementById('cliente-compl').value;
            let end = document.getElementById('cliente-end').value;
            
            // Adiciona n√∫mero e complemento ao endere√ßo se preenchidos
            if (num && !end.includes(', ' + num)) {
                end = end.replace(/,/, ', ' + num + ',');
            }
            if (compl) {
                end += ' - ' + compl;
            }
            
            const data = {
                nome: document.getElementById('cliente-nome').value,
                doc: document.getElementById('cliente-doc').value,
                tel: document.getElementById('cliente-tel').value,
                email: document.getElementById('cliente-email').value,
                cep: document.getElementById('cliente-cep').value,
                num: num,
                end: end,
                compl: compl,
                obs: document.getElementById('cliente-obs').value
            };
            if (!data.nome) { toast('Preencha o nome'); return; }
            if (id) await db.clientes.update(parseInt(id), data);
            else await db.clientes.add(data);
            toast('Cliente salvo!');
            closeModal('modal-cliente');
            loadClientes();
        }

        // OR√áAMENTOS
        let allClientes = [];
        let allServicos = [];
        let selectedServico = null;

        async function loadSelects() {
            allClientes = await db.clientes.toArray();
            allServicos = await db.servicos.toArray();
        }

        async function searchClientes(term) {
            const list = document.getElementById('cliente-autocomplete');
            if (!term || term.length < 2) {
                list.classList.remove('show');
                return;
            }
            const filtered = allClientes.filter(c => 
                c.nome.toLowerCase().includes(term.toLowerCase()) ||
                (c.tel && c.tel.includes(term))
            ).slice(0, 8);
            
            if (filtered.length === 0) {
                list.innerHTML = '<div class="autocomplete-item">Nenhum cliente encontrado</div>';
            } else {
                list.innerHTML = filtered.map(c => {
                    const nomeEscaped = c.nome.replace(/"/g, '&quot;').replace(/'/g, '&#39;');
                    const enderecoResumo = c.end ? c.end.substring(0, 40) + '...' : '';
                    return `
                        <div class="autocomplete-item" data-id="${c.id}" data-nome="${nomeEscaped}" onclick="selectClienteFromEl(this)">
                            <strong>${c.nome}</strong>
                            <small>${c.tel || ''} ${enderecoResumo ? '‚Ä¢ ' + enderecoResumo : ''}</small>
                        </div>
                    `;
                }).join('');
            }
            list.classList.add('show');
        }

        function selectClienteFromEl(el) {
            const id = el.dataset.id;
            const nome = el.dataset.nome;
            document.getElementById('orc-cliente').value = id;
            document.getElementById('orc-cliente-search').value = nome;
            document.getElementById('cliente-autocomplete').classList.remove('show');
        }

        function selectCliente(id, nome) {
            document.getElementById('orc-cliente').value = id;
            document.getElementById('orc-cliente-search').value = nome;
            document.getElementById('cliente-autocomplete').classList.remove('show');
        }

        async function searchServicos(term) {
            const list = document.getElementById('servico-autocomplete');
            if (!term || term.length < 2) {
                list.classList.remove('show');
                return;
            }
            const filtered = allServicos.filter(s => 
                s.nome.toLowerCase().includes(term.toLowerCase())
            ).slice(0, 8);
            
            if (filtered.length === 0) {
                list.innerHTML = '<div class="autocomplete-item">Nenhum servi√ßo encontrado</div>';
            } else {
                list.innerHTML = filtered.map(s => `
                    <div class="autocomplete-item" onclick="selectServico(${s.id})">
                        <strong>${s.nome}</strong>
                        <small>R$ ${parseFloat(s.preco).toFixed(2)} / ${s.un}</small>
                    </div>
                `).join('');
            }
            list.classList.add('show');
        }

        function selectServico(id) {
            selectedServico = allServicos.find(s => s.id === id);
            if (selectedServico) {
                document.getElementById('orc-serv-search').value = selectedServico.nome;
                document.getElementById('orc-serv-sel').value = id;
                document.getElementById('orc-preco-unit').value = numberToMoeda(selectedServico.preco);
                document.getElementById('servico-autocomplete').classList.remove('show');
                document.getElementById('orc-qtd').focus();
            }
        }

        // Fechar autocomplete ao clicar fora
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.autocomplete-wrapper')) {
                document.querySelectorAll('.autocomplete-list').forEach(l => l.classList.remove('show'));
            }
        });

        function addItemOrc() {
            const servId = document.getElementById('orc-serv-sel').value;
            const qtd = moedaToNumber(document.getElementById('orc-qtd').value);
            const precoUnit = moedaToNumber(document.getElementById('orc-preco-unit').value);
            const ambiente = document.getElementById('orc-ambiente').value.trim();
            
            if (!servId || !qtd || !precoUnit) { 
                toast('Preencha servi√ßo, quantidade e pre√ßo'); 
                return; 
            }
            
            const servico = allServicos.find(s => s.id === parseInt(servId));
            if (!servico) { toast('Servi√ßo n√£o encontrado'); return; }
            
            orcItens.push({
                servId: parseInt(servId),
                nome: servico.nome,
                preco: precoUnit,
                un: servico.un,
                qtd,
                total: qtd * precoUnit,
                ambiente: ambiente || 'Geral'
            });
            
            renderOrcItens();
            
            // Limpar campos
            document.getElementById('orc-serv-search').value = '';
            document.getElementById('orc-serv-sel').value = '';
            document.getElementById('orc-qtd').value = '';
            document.getElementById('orc-preco-unit').value = '';
            selectedServico = null;
        }

        function removeItemOrc(i) { 
            orcItens.splice(i, 1); 
            renderOrcItens(); 
        }

        function updateItemOrc(i, field, value) {
            if (field === 'qtd') {
                orcItens[i].qtd = moedaToNumber(value);
            } else if (field === 'preco') {
                orcItens[i].preco = moedaToNumber(value);
            }
            orcItens[i].total = orcItens[i].qtd * orcItens[i].preco;
            renderOrcItens();
        }

        function renderOrcItens() {
            const c = document.getElementById('orc-itens');
            const total = orcItens.reduce((s, x) => s + x.total, 0);
            
            // Agrupar por ambiente
            const ambientes = {};
            orcItens.forEach((item, i) => {
                const amb = item.ambiente || 'Geral';
                if (!ambientes[amb]) ambientes[amb] = [];
                ambientes[amb].push({...item, index: i});
            });
            
            let html = '';
            for (const [ambiente, itens] of Object.entries(ambientes)) {
                html += `<div class="orc-item-ambiente">üìç ${ambiente}</div>`;
                html += itens.map(x => `
                    <div class="orc-item">
                        <div class="orc-item-info">
                            <div class="orc-item-name">${x.nome}</div>
                            <div class="orc-item-edit">
                                <input type="text" value="${numberToMoeda(x.qtd)}" onchange="updateItemOrc(${x.index}, 'qtd', this.value)" oninput="this.value = maskMoeda(this.value)" title="Quantidade"> ${x.un} √ó
                                <input type="text" value="${numberToMoeda(x.preco)}" onchange="updateItemOrc(${x.index}, 'preco', this.value)" oninput="this.value = maskMoeda(this.value)" title="Pre√ßo unit√°rio">
                            </div>
                        </div>
                        <div class="orc-item-val">R$ ${numberToMoeda(x.total)}</div>
                        <button class="orc-item-del" onclick="removeItemOrc(${x.index})">‚úï</button>
                    </div>
                `).join('');
            }
            
            c.innerHTML = html;
            document.getElementById('orc-total').textContent = `R$ ${numberToMoeda(total)}`;
        }

        async function editOrcamento() {
            const o = await db.orcamentos.get(currentOrcId);
            if (!o) { toast('Or√ßamento n√£o encontrado'); return; }
            
            const cliente = await db.clientes.get(o.clienteId);
            
            // Carregar listas para autocomplete
            await loadSelects();
            
            // Fechar modal de detalhes
            closeModal('modal-det');
            
            // Marcar como edi√ß√£o para n√£o limpar os dados
            isEditingOrc = true;
            
            // Carregar itens ANTES de abrir o modal
            orcItens = o.itens.map(item => ({...item}));
            
            // Abrir modal
            await openModal('modal-orcamento');
            
            // Preencher dados no modal de edi√ß√£o DEPOIS de abrir
            document.getElementById('orc-id').value = o.id;
            document.getElementById('orc-titulo').value = o.titulo;
            document.getElementById('orc-cliente').value = o.clienteId;
            document.getElementById('orc-cliente-search').value = cliente?.nome || '';
            document.getElementById('orc-pagamento').value = o.pagamento || '';
            document.getElementById('orc-obs').value = o.obs || '';
            document.getElementById('modal-orc-title').textContent = 'Editar Or√ßamento #' + o.id;
            
            // Renderizar itens
            renderOrcItens();
        }

        async function saveOrcamento() {
            const orcId = document.getElementById('orc-id').value;
            const cliId = document.getElementById('orc-cliente').value;
            const titulo = document.getElementById('orc-titulo').value || 'Or√ßamento';
            const pagamento = document.getElementById('orc-pagamento').value;
            const obs = document.getElementById('orc-obs').value;
            
            console.log('Salvando or√ßamento:', { orcId, cliId, titulo, itens: orcItens });
            
            if (!cliId) { 
                toast('Selecione um cliente'); 
                console.error('Cliente n√£o selecionado');
                return; 
            }
            if (!orcItens.length) { 
                toast('Adicione servi√ßos'); 
                console.error('Nenhum item adicionado');
                return; 
            }
            
            try {
                const total = orcItens.reduce((s, x) => s + x.total, 0);
                const pArr = await db.perfil.toArray();
                const val = pArr[0]?.val || 15;
                
                if (orcId) {
                    // Editar existente
                    await db.orcamentos.update(parseInt(orcId), {
                        clienteId: parseInt(cliId),
                        titulo,
                        itens: orcItens,
                        total,
                        pagamento,
                        obs
                    });
                    console.log('Or√ßamento atualizado:', orcId);
                    toast('Or√ßamento atualizado!');
                } else {
                    // Criar novo
                    const novoOrc = {
                        clienteId: parseInt(cliId),
                        titulo,
                        itens: orcItens,
                        total,
                        status: 'pendente',
                        data: new Date().toISOString(),
                        val,
                        pagamento,
                        obs
                    };
                    
                    console.log('Objeto a salvar:', novoOrc);
                    
                    const id = await db.orcamentos.add(novoOrc);
                    console.log('Or√ßamento salvo com ID:', id);
                    toast('Or√ßamento criado!');
                }
                
                closeModal('modal-orcamento');
                orcItens = [];
                loadDashboard();
                loadOrcamentos();
            } catch (err) {
                console.error('Erro ao salvar:', err);
                toast('Erro ao salvar or√ßamento!');
            }
        }

        async function loadOrcamentos() {
            let o = await db.orcamentos.toArray();
            const c = document.getElementById('orcamentos-list');
            
            if (!o.length) {
                c.innerHTML = '<div class="empty-state"><p>Nenhum or√ßamento</p><button class="btn btn-primary" style="max-width:180px;margin:0 auto;" onclick="openModal(\'modal-orcamento\')">Criar</button></div>';
                document.getElementById('filters-summary').classList.remove('show');
                return;
            }
            
            // Guardar todos para filtros
            window.allOrcamentos = o;
            
            const cli = await db.clientes.toArray();
            window.allClientesMap = {}; 
            cli.forEach(x => window.allClientesMap[x.id] = x.nome);
            
            applyOrcFilters();
        }

        function applyOrcFilters() {
            const search = document.getElementById('search-orc').value.toLowerCase();
            const statusFilter = document.getElementById('filter-status').value;
            const periodoFilter = document.getElementById('filter-periodo').value;
            
            let filtered = window.allOrcamentos || [];
            
            // Filtro por status
            if (statusFilter) {
                filtered = filtered.filter(x => x.status === statusFilter);
            }
            
            // Filtro por per√≠odo
            if (periodoFilter) {
                const dias = parseInt(periodoFilter);
                const dataLimite = new Date();
                dataLimite.setDate(dataLimite.getDate() - dias);
                filtered = filtered.filter(x => new Date(x.data) >= dataLimite);
            }
            
            // Filtro por busca texto
            if (search) {
                filtered = filtered.filter(x => {
                    const clienteNome = window.allClientesMap[x.clienteId] || '';
                    return x.titulo.toLowerCase().includes(search) ||
                           clienteNome.toLowerCase().includes(search) ||
                           x.status.includes(search);
                });
            }
            
            renderOrcamentosList(filtered);
            
            // Resumo dos filtros
            const summary = document.getElementById('filters-summary');
            const totalValor = filtered.reduce((s, x) => s + x.total, 0);
            if (statusFilter || periodoFilter || search) {
                summary.innerHTML = `<strong>${filtered.length}</strong> or√ßamento(s) encontrado(s) ‚Ä¢ Total: <strong>R$ ${totalValor.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</strong>`;
                summary.classList.add('show');
            } else {
                summary.classList.remove('show');
            }
        }

        function renderOrcamentosList(orcamentos) {
            const c = document.getElementById('orcamentos-list');
            const map = window.allClientesMap || {};
            const badges = { 
                pendente: '<span class="badge badge-pending">üü° Pendente</span>', 
                fechado: '<span class="badge badge-approved">‚úÖ Fechado</span>', 
                recusado: '<span class="badge badge-rejected">‚ùå Recusado</span>' 
            };
            
            if (!orcamentos.length) {
                c.innerHTML = '<div class="empty-state" style="padding:20px;"><p>Nenhum or√ßamento encontrado com esses filtros</p></div>';
                return;
            }
            
            c.innerHTML = orcamentos.reverse().map(x => `
                <div class="list-item" onclick="viewOrc(${x.id})">
                    <div class="list-icon"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline></svg></div>
                    <div class="list-info">
                        <div class="list-title">${x.titulo}</div>
                        <div class="list-sub">${map[x.clienteId] || ''} ‚Ä¢ ${new Date(x.data).toLocaleDateString('pt-BR')}</div>
                        ${badges[x.status]}
                    </div>
                    <div class="list-value">R$ ${numberToMoeda(x.total)}</div>
                </div>
            `).join('');
        }

        async function viewOrc(id) {
            currentOrcId = id;
            const o = await db.orcamentos.get(id);
            const cli = await db.clientes.get(o.clienteId);
            const badges = { pendente: '<span class="badge badge-pending">üü° Pendente</span>', fechado: '<span class="badge badge-approved">‚úÖ Fechado</span>', recusado: '<span class="badge badge-rejected">‚ùå Recusado</span>' };
            
            // Agrupar itens por ambiente
            const ambientes = {};
            o.itens.forEach(item => {
                const amb = item.ambiente || 'Geral';
                if (!ambientes[amb]) ambientes[amb] = [];
                ambientes[amb].push(item);
            });
            
            let itensHtml = '';
            for (const [ambiente, itens] of Object.entries(ambientes)) {
                itensHtml += `<div class="orc-item-ambiente">üìç ${ambiente}</div>`;
                itensHtml += itens.map(x => `
                    <div class="orc-item">
                        <div class="orc-item-info">
                            <div class="orc-item-name">${x.nome}</div>
                            <div class="orc-item-det">${numberToMoeda(x.qtd)} ${x.un} √ó R$ ${numberToMoeda(x.preco)}</div>
                        </div>
                        <div class="orc-item-val">R$ ${numberToMoeda(x.total)}</div>
                    </div>
                `).join('');
            }
            
            let pagamentoHtml = o.pagamento ? `<div class="card" style="background:var(--cinza-bg);margin-bottom:14px;"><strong>üí≥ Pagamento:</strong> ${o.pagamento}</div>` : '';
            let obsHtml = o.obs ? `<div class="card" style="background:var(--cinza-bg);margin-bottom:14px;font-size:12px;"><strong>üìù Observa√ß√µes:</strong><br>${o.obs.replace(/\n/g, '<br>')}</div>` : '';
            
            document.getElementById('det-content').innerHTML = `
                <div style="margin-bottom:14px;"><h3 style="margin-bottom:4px;">${o.titulo}</h3>${badges[o.status]}</div>
                <div class="card" style="background:var(--cinza-bg);margin-bottom:14px;">
                    <strong>Cliente:</strong> ${cli?.nome || 'N/A'}<br>
                    <strong>Tel:</strong> ${cli?.tel || 'N/A'}<br>
                    <strong>End:</strong> ${cli?.end || 'N/A'}
                </div>
                <div class="card-title">Itens</div>
                ${itensHtml}
                <div class="orc-total"><div class="orc-total-label">Total</div><div class="orc-total-value">R$ ${numberToMoeda(o.total)}</div></div>
                ${pagamentoHtml}
                ${obsHtml}
                <p style="font-size:11px;color:var(--cinza-texto);margin-top:12px;text-align:center;">Criado em ${new Date(o.data).toLocaleDateString('pt-BR')} ‚Ä¢ V√°lido por ${o.val} dias</p>
            `;
            openModal('modal-det');
        }

        async function setStatus(s) {
            await db.orcamentos.update(currentOrcId, { status: s });
            toast('Status atualizado!');
            closeModal('modal-det');
            loadOrcamentos();
            loadDashboard();
        }

        // DASHBOARD
        let currentFilter = 'todos';

        async function loadDashboard() {
            const o = await db.orcamentos.toArray();
            const total = o.length;
            const fechados = o.filter(x => x.status === 'fechado');
            const pendentes = o.filter(x => x.status === 'pendente').length;
            const recusados = o.filter(x => x.status === 'recusado').length;
            const valorFechado = fechados.reduce((s, x) => s + x.total, 0);
            
            document.getElementById('stat-total').textContent = total;
            document.getElementById('stat-fechados').textContent = fechados.length;
            document.getElementById('stat-pendentes').textContent = pendentes;
            document.getElementById('stat-recusados').textContent = recusados;
            document.getElementById('stat-valor').textContent = `R$ ${valorFechado.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}`;
            
            loadUltimos();
        }

        function filterOrcamentos(status) {
            currentFilter = status;
            showPage('orcamentos');
            
            // Aplica o filtro ap√≥s carregar a p√°gina
            setTimeout(() => {
                const statusSelect = document.getElementById('filter-status');
                const searchInput = document.getElementById('search-orc');
                const periodoSelect = document.getElementById('filter-periodo');
                
                // Limpa outros filtros
                searchInput.value = '';
                periodoSelect.value = '';
                
                // Define o status
                if (status === 'todos') {
                    statusSelect.value = '';
                } else {
                    statusSelect.value = status;
                }
                
                applyOrcFilters();
            }, 100);
        }

        async function loadUltimos() {
            const o = await db.orcamentos.where('status').equals('pendente').reverse().toArray();
            const c = document.getElementById('ultimos-orc');
            if (!o.length) { 
                c.innerHTML = '<div class="empty-state" style="padding:20px;"><p>Nenhum or√ßamento pendente üéâ</p></div>'; 
                return; 
            }
            const cli = await db.clientes.toArray();
            const map = {}; cli.forEach(x => map[x.id] = x.nome);
            c.innerHTML = o.slice(0, 5).map(x => `
                <div class="list-item" onclick="viewOrc(${x.id})">
                    <div class="list-icon" style="background:rgba(247,192,38,0.2);"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--amarelo)" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg></div>
                    <div class="list-info">
                        <div class="list-title">${x.titulo}</div>
                        <div class="list-sub">${map[x.clienteId] || ''} ‚Ä¢ ${new Date(x.data).toLocaleDateString('pt-BR')}</div>
                    </div>
                    <div class="list-value">R$ ${numberToMoeda(x.total)}</div>
                </div>
            `).join('');
        }

        function filterList(type) {
            const search = document.getElementById('search-' + (type === 'servicos' ? 'serv' : type === 'clientes' ? 'cli' : 'orc')).value.toLowerCase();
            document.querySelectorAll(`#${type}-list .list-item`).forEach(x => {
                x.style.display = x.textContent.toLowerCase().includes(search) ? 'flex' : 'none';
            });
        }

        // PDF
        async function exportPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const o = await db.orcamentos.get(currentOrcId);
            const cli = await db.clientes.get(o.clienteId);
            const pArr = await db.perfil.toArray();
            const p = pArr[0] || {};
            
            // Cabe√ßalho
            doc.setFillColor(26, 59, 90);
            doc.rect(0, 0, 210, 40, 'F');
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(22);
            doc.setFont('helvetica', 'bold');
            doc.text('PS', 20, 22);
            doc.setFontSize(10);
            doc.text('PRO', 33, 22);
            doc.setFontSize(11);
            doc.text(p.nome || 'Minha Empresa', 60, 16);
            doc.setFontSize(9);
            doc.setFont('helvetica', 'normal');
            doc.text(p.tel || '', 60, 23);
            doc.text(p.email || '', 60, 29);
            doc.text((p.end || '').substring(0, 60), 60, 35);
            
            // T√≠tulo e dados do or√ßamento
            doc.setTextColor(26, 59, 90);
            doc.setFontSize(16);
            doc.setFont('helvetica', 'bold');
            doc.text('ORCAMENTO', 20, 55);
            doc.setFontSize(9);
            doc.setFont('helvetica', 'normal');
            doc.setTextColor(100, 100, 100);
            doc.text('No: ' + o.id.toString().padStart(4, '0'), 160, 50);
            doc.text('Data: ' + new Date(o.data).toLocaleDateString('pt-BR'), 160, 56);
            doc.text('Validade: ' + o.val + ' dias', 160, 62);
            
            // Box Cliente
            doc.setFillColor(245, 247, 250);
            doc.roundedRect(20, 68, 170, 28, 2, 2, 'F');
            doc.setTextColor(26, 59, 90);
            doc.setFontSize(10);
            doc.setFont('helvetica', 'bold');
            doc.text('CLIENTE', 25, 77);
            doc.setFont('helvetica', 'normal');
            doc.setTextColor(60, 60, 60);
            doc.text(cli?.nome || 'N/A', 25, 84);
            const cliInfo = 'Tel: ' + (cli?.tel || 'N/A') + ' | End: ' + (cli?.end || 'N/A');
            doc.text(cliInfo.substring(0, 85), 25, 91);
            
            // Agrupar itens por ambiente
            const ambientes = {};
            o.itens.forEach(item => {
                const amb = item.ambiente || 'Geral';
                if (!ambientes[amb]) ambientes[amb] = [];
                ambientes[amb].push(item);
            });
            
            let y = 108;
            
            // Posi√ß√µes das colunas (alinhadas)
            const colServico = 22;
            const colQtd = 120;
            const colUnit = 145;
            const colTotal = 172;
            
            for (const [ambiente, itens] of Object.entries(ambientes)) {
                // Verificar se precisa nova p√°gina
                if (y > 250) {
                    doc.addPage();
                    y = 20;
                }
                
                // T√≠tulo do ambiente (sem emoji)
                doc.setFillColor(26, 59, 90);
                doc.rect(20, y, 170, 8, 'F');
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(9);
                doc.setFont('helvetica', 'bold');
                doc.text('LOCAL: ' + ambiente.toUpperCase(), 25, y + 5.5);
                y += 10;
                
                // Cabe√ßalho da tabela
                doc.setFillColor(230, 235, 240);
                doc.rect(20, y, 170, 7, 'F');
                doc.setTextColor(26, 59, 90);
                doc.setFontSize(8);
                doc.setFont('helvetica', 'bold');
                doc.text('SERVICO', colServico, y + 5);
                doc.text('QTD', colQtd, y + 5);
                doc.text('UNIT.', colUnit, y + 5);
                doc.text('TOTAL', colTotal, y + 5);
                y += 9;
                
                // Itens
                doc.setFont('helvetica', 'normal');
                doc.setTextColor(60, 60, 60);
                doc.setFontSize(8);
                
                itens.forEach((x, i) => {
                    if (y > 260) {
                        doc.addPage();
                        y = 20;
                    }
                    
                    // Fundo alternado
                    if (i % 2 === 0) { 
                        doc.setFillColor(250, 250, 250); 
                        doc.rect(20, y - 4, 170, 7, 'F'); 
                    }
                    
                    // Dados
                    doc.setTextColor(60, 60, 60);
                    doc.text(x.nome.substring(0, 45), colServico, y);
                    doc.text(numberToMoeda(x.qtd) + ' ' + x.un, colQtd, y);
                    doc.text('R$ ' + numberToMoeda(x.preco), colUnit, y);
                    doc.text('R$ ' + numberToMoeda(x.total), colTotal, y);
                    y += 7;
                });
                
                y += 5;
            }
            
            // Total
            y += 2;
            doc.setFillColor(247, 192, 38);
            doc.roundedRect(120, y, 70, 12, 2, 2, 'F');
            doc.setTextColor(26, 59, 90);
            doc.setFontSize(11);
            doc.setFont('helvetica', 'bold');
            doc.text('TOTAL: R$ ' + numberToMoeda(o.total), 125, y + 8);
            
            y += 20;
            
            // Forma de Pagamento
            if (o.pagamento) {
                if (y > 250) { doc.addPage(); y = 20; }
                doc.setFillColor(245, 247, 250);
                doc.roundedRect(20, y, 170, 12, 2, 2, 'F');
                doc.setTextColor(26, 59, 90);
                doc.setFontSize(9);
                doc.setFont('helvetica', 'bold');
                doc.text('FORMA DE PAGAMENTO:', 25, y + 8);
                doc.setFont('helvetica', 'normal');
                doc.setTextColor(60, 60, 60);
                doc.text(o.pagamento.substring(0, 55), 78, y + 8);
                y += 18;
            }
            
            // Observa√ß√µes
            if (o.obs) {
                if (y > 230) { doc.addPage(); y = 20; }
                
                doc.setFillColor(245, 247, 250);
                doc.roundedRect(20, y, 170, 8, 2, 2, 'F');
                doc.setTextColor(26, 59, 90);
                doc.setFontSize(9);
                doc.setFont('helvetica', 'bold');
                doc.text('OBSERVACOES:', 25, y + 5.5);
                y += 12;
                
                doc.setFont('helvetica', 'normal');
                doc.setTextColor(60, 60, 60);
                doc.setFontSize(8);
                
                // Quebrar observa√ß√µes em linhas
                const obsLines = doc.splitTextToSize(o.obs, 165);
                obsLines.forEach(line => {
                    if (y > 275) { doc.addPage(); y = 20; }
                    doc.text(line, 25, y);
                    y += 5;
                });
            }
            
            // Rodap√©
            doc.setTextColor(150, 150, 150);
            doc.setFontSize(7);
            doc.setFont('helvetica', 'normal');
            doc.text('Orcamento gerado pelo PS Pro - Painel Services', 20, 285);
            
            doc.save('orcamento_' + o.id + '_' + (cli?.nome?.replace(/\s/g, '_') || 'cliente') + '.pdf');
            toast('PDF exportado!');
        }

        // M√ÅSCARAS
        function maskCPFCNPJ(v) {
            v = v.replace(/\D/g, '');
            if (v.length <= 11) {
                v = v.replace(/(\d{3})(\d)/, '$1.$2');
                v = v.replace(/(\d{3})(\d)/, '$1.$2');
                v = v.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
            } else {
                v = v.substring(0, 14);
                v = v.replace(/^(\d{2})(\d)/, '$1.$2');
                v = v.replace(/^(\d{2})\.(\d{3})(\d)/, '$1.$2.$3');
                v = v.replace(/\.(\d{3})(\d)/, '.$1/$2');
                v = v.replace(/(\d{4})(\d)/, '$1-$2');
            }
            return v;
        }

        function maskTel(v) {
            v = v.replace(/\D/g, '');
            v = v.substring(0, 11);
            if (v.length > 10) {
                v = v.replace(/^(\d{2})(\d{5})(\d{4}).*/, '($1) $2-$3');
            } else if (v.length > 6) {
                v = v.replace(/^(\d{2})(\d{4})(\d{0,4}).*/, '($1) $2-$3');
            } else if (v.length > 2) {
                v = v.replace(/^(\d{2})(\d{0,5})/, '($1) $2');
            } else if (v.length > 0) {
                v = v.replace(/^(\d*)/, '($1');
            }
            return v;
        }

        // Aplicar m√°scaras - Perfil
        document.getElementById('perfil-doc').addEventListener('input', function(e) {
            e.target.value = maskCPFCNPJ(e.target.value);
        });
        document.getElementById('perfil-tel').addEventListener('input', function(e) {
            e.target.value = maskTel(e.target.value);
        });
        document.getElementById('perfil-cep').addEventListener('input', function(e) {
            e.target.value = maskCEP(e.target.value);
        });

        // Busca CEP para Perfil
        async function buscarCEPPerfil(cep) {
            cep = cep.replace(/\D/g, '');
            if (cep.length !== 8) return;
            
            toast('Buscando CEP...');
            
            try {
                const resp = await fetch(`https://viacep.com.br/ws/${cep}/json/`, {
                    method: 'GET',
                    mode: 'cors'
                });
                
                if (!resp.ok) {
                    toast('Erro na busca do CEP');
                    return;
                }
                
                const data = await resp.json();
                
                if (data.erro) {
                    toast('CEP n√£o encontrado');
                    return;
                }
                
                const partes = [];
                if (data.logradouro) partes.push(data.logradouro);
                if (data.bairro) partes.push(data.bairro);
                if (data.localidade) partes.push(data.localidade + (data.uf ? ' - ' + data.uf : ''));
                
                const endereco = partes.join(', ');
                document.getElementById('perfil-end').value = endereco;
                document.getElementById('perfil-num').focus();
                toast('Endere√ßo encontrado!');
            } catch (err) {
                console.error('Erro CEP:', err);
                toast('Erro ao buscar CEP. Verifique sua conex√£o.');
            }
        }

        // Aplicar m√°scaras - Cliente
        document.getElementById('cliente-doc').addEventListener('input', function(e) {
            e.target.value = maskCPFCNPJ(e.target.value);
        });
        document.getElementById('cliente-tel').addEventListener('input', function(e) {
            e.target.value = maskTel(e.target.value);
        });
        document.getElementById('cliente-cep').addEventListener('input', function(e) {
            e.target.value = maskCEP(e.target.value);
        });

        // M√°scara CEP
        function maskCEP(v) {
            v = v.replace(/\D/g, '');
            v = v.substring(0, 8);
            v = v.replace(/^(\d{5})(\d)/, '$1-$2');
            return v;
        }

        // M√°scara Moeda Brasileira (1.234,56)
        function maskMoeda(v) {
            v = v.replace(/\D/g, '');
            if (v === '') return '';
            v = (parseInt(v) / 100).toFixed(2);
            v = v.replace('.', ',');
            v = v.replace(/\B(?=(\d{3})+(?!\d))/g, '.');
            return v;
        }

        // Converter moeda formatada para n√∫mero
        function moedaToNumber(v) {
            if (!v) return 0;
            return parseFloat(v.replace(/\./g, '').replace(',', '.')) || 0;
        }

        // Formatar n√∫mero para moeda
        function numberToMoeda(n) {
            if (!n && n !== 0) return '';
            return n.toFixed(2).replace('.', ',').replace(/\B(?=(\d{3})+(?!\d))/g, '.');
        }

        // Busca CEP via ViaCEP
        async function buscarCEP(cep) {
            cep = cep.replace(/\D/g, '');
            if (cep.length !== 8) return;
            
            toast('Buscando CEP...');
            
            try {
                const resp = await fetch(`https://viacep.com.br/ws/${cep}/json/`, {
                    method: 'GET',
                    mode: 'cors'
                });
                
                if (!resp.ok) {
                    toast('Erro na busca do CEP');
                    return;
                }
                
                const data = await resp.json();
                
                if (data.erro) {
                    toast('CEP n√£o encontrado');
                    return;
                }
                
                const partes = [];
                if (data.logradouro) partes.push(data.logradouro);
                if (data.bairro) partes.push(data.bairro);
                if (data.localidade) partes.push(data.localidade + (data.uf ? ' - ' + data.uf : ''));
                
                const endereco = partes.join(', ');
                document.getElementById('cliente-end').value = endereco;
                document.getElementById('cliente-num').focus();
                toast('Endere√ßo encontrado!');
            } catch (err) {
                console.error('Erro CEP:', err);
                toast('Erro ao buscar CEP. Verifique sua conex√£o.');
            }
        }

        // DADOS INICIAIS
        async function seedDatabase() {
            const servicosCount = await db.servicos.count();
            if (servicosCount > 0) return; // J√° tem dados

            // SERVI√áOS - Tabela de Pintura 2025
            const servicos = [
                // DI√ÅRIAS
                { nome: 'Di√°ria Ajudante', un: 'di√°ria', preco: 116.35, desc: 'Servi√ßo b√°sico - 8hs' },
                { nome: 'Di√°ria Profissional', un: 'di√°ria', preco: 202.08, desc: 'Servi√ßos gerais de pintura - 8hs' },
                { nome: 'Di√°ria L√≠der', un: 'di√°ria', preco: 232.70, desc: 'Pintor Profissional L√≠der - 8hs' },
                { nome: 'Di√°ria Cordeiro Ajudante', un: 'di√°ria', preco: 220.45, desc: 'Pintor Ajudante Cordeiro/Cadeirinha - 8hs' },
                { nome: 'Di√°ria Cordeiro Profissional', un: 'di√°ria', preco: 281.69, desc: 'Pintor Profissional Cordeiro/Cadeirinha - 8hs' },
                { nome: 'Di√°ria Propriet√°rio', un: 'di√°ria', preco: 330.67, desc: 'Com ferramentas, equipamentos e certificados' },
                
                // LAVAGEM
                { nome: 'Lavagem Tijolinho', un: 'm¬≤', preco: 5.16, desc: 'Para aplica√ß√£o de silicone - at√© 3m altura' },
                { nome: 'Lavagem Calha Simples', un: 'm', preco: 13.78, desc: 'Telhado simples - at√© 3m altura' },
                { nome: 'Lavagem Calha Sobrado', un: 'm', preco: 21.77, desc: 'Acima 3 metros' },
                { nome: 'Lavagem Pingadeiras', un: 'm', preco: 9.53, desc: 'Para muros' },
                { nome: 'Lavagem Caixa D√°gua Baixa', un: 'un', preco: 217.61, desc: 'Telhado baixo - at√© 3m' },
                { nome: 'Lavagem Caixa D√°gua Alta', un: 'un', preco: 326.37, desc: 'Telhado alto - acima 3m' },
                { nome: 'Lavagem Telhado Baixo', un: 'm¬≤', preco: 13.61, desc: 'Lavadora pressurizada - at√© 3m' },
                { nome: 'Lavagem Telhado Alto', un: 'm¬≤', preco: 17.63, desc: 'Lavadora pressurizada - acima 3m' },
                { nome: 'Lavagem Parede at√© 3m', un: 'm¬≤', preco: 4.54, desc: 'Sujeiras em geral' },
                { nome: 'Lavagem Parede acima 3m', un: 'm¬≤', preco: 11.51, desc: 'Sujeiras em geral' },
                { nome: 'Lavagem Piso Mangueira', un: 'm¬≤', preco: 5.20, desc: 'Lavagem simples' },
                { nome: 'Lavagem Piso Pressurizada', un: 'm¬≤', preco: 8.56, desc: '√Ågua pressurizada' },
                
                // TELHAS
                { nome: 'Resina Telhas 2 dem√£os', un: 'm¬≤', preco: 23.47, desc: 'Lavagem incluso' },
                { nome: 'Resina Telhas 3 dem√£os', un: 'm¬≤', preco: 29.99, desc: 'Lavagem incluso' },
                { nome: 'Resina Telhas Fibrocimento', un: 'm¬≤', preco: 35.38, desc: 'Fibrocimento ou Amianto' },
                
                // CALHAS PINTURA
                { nome: 'Pintura Calha Simples', un: 'm', preco: 30.50, desc: 'Telhado simples - at√© 3m' },
                { nome: 'Pintura Calha Sobrado', un: 'm', preco: 38.10, desc: 'Acima 3 metros' },
                { nome: 'Pintura Pingadeiras', un: 'm', preco: 18.43, desc: 'Para muros' },
                
                // EP√ìXI
                { nome: 'Ep√≥xi Industrial', un: 'm¬≤', preco: 285.48, desc: 'Alta espessura - Fundo + Acabamento' },
                { nome: 'Ep√≥xi 3D Art√≠stico', un: 'm¬≤', preco: 407.84, desc: 'Fundo + Acab + Adesivo' },
                
                // REPAROS
                { nome: 'Acerto Cimento Parede', un: 'm¬≤', preco: 18.37, desc: 'Grandes corre√ß√µes - at√© 3m' },
                { nome: 'Fissuras Selante', un: 'm', preco: 11.45, desc: 'Selante para trincas' },
                { nome: 'Trincas Tela e Massa', un: 'm', preco: 22.45, desc: 'Tela e massa' },
                
                // PAPEL PAREDE
                { nome: 'Papel Parede Comum at√© 3m', un: 'un', preco: 91.74, desc: 'Por rolo' },
                { nome: 'Papel Parede Comum acima 3m', un: 'un', preco: 139.37, desc: 'Por rolo' },
                { nome: 'Papel Parede Importado at√© 3m', un: 'un', preco: 125.70, desc: 'Por rolo' },
                
                // PINTURA PAREDE - L√ÅTEX PVA
                { nome: 'Repintura L√°tex PVA 2 dem√£os', un: 'm¬≤', preco: 8.50, desc: 'Apenas repintura' },
                { nome: 'Selador + 2 L√°tex PVA', un: 'm¬≤', preco: 12.80, desc: '1 selador + 2 dem√£os tinta' },
                { nome: 'Selador + 3 L√°tex PVA', un: 'm¬≤', preco: 14.50, desc: '1 selador + 3 dem√£os tinta' },
                { nome: 'Selador + Massa PVA + 2 L√°tex', un: 'm¬≤', preco: 22.50, desc: 'Selador + 2 massa + 2 tinta' },
                { nome: 'Selador + Massa PVA + 3 L√°tex', un: 'm¬≤', preco: 25.80, desc: 'Selador + 2 massa + 3 tinta' },
                
                // PINTURA PAREDE - ACR√çLICA
                { nome: 'Repintura Acr√≠lica Fosca 2 dem√£os', un: 'm¬≤', preco: 10.20, desc: 'Apenas repintura' },
                { nome: 'Selador + 2 Acr√≠lica Fosca', un: 'm¬≤', preco: 15.30, desc: '1 selador + 2 dem√£os' },
                { nome: 'Selador + 3 Acr√≠lica Fosca', un: 'm¬≤', preco: 17.80, desc: '1 selador + 3 dem√£os' },
                { nome: 'Selador + Massa Acr√≠lica + 2 Acr√≠lica', un: 'm¬≤', preco: 28.50, desc: 'Selador + 2 massa + 2 tinta' },
                { nome: 'Selador + Massa Acr√≠lica + 3 Acr√≠lica', un: 'm¬≤', preco: 32.80, desc: 'Selador + 2 massa + 3 tinta' },
                { nome: 'Selador + 3 Massa + 2 Acr√≠lica Acetinado', un: 'm¬≤', preco: 48.28, desc: 'Premium acetinado' },
                { nome: 'Selador + 3 Massa + 3 Acr√≠lica Acetinado', un: 'm¬≤', preco: 51.11, desc: 'Premium acetinado' },
                { nome: 'Selador + 2 Massa + 2 Acr√≠lica Semi-Brilho', un: 'm¬≤', preco: 49.90, desc: 'Premium semi-brilho' },
                { nome: 'Selador + 3 Massa + 3 Acr√≠lica Semi-Brilho', un: 'm¬≤', preco: 54.86, desc: 'Premium semi-brilho' },
                
                // DRYWALL
                { nome: 'Repintura Drywall', un: 'm¬≤', preco: 14.29, desc: 'Drywall j√° pintado' },
                { nome: 'Drywall Fundo + 2 Fosco', un: 'm¬≤', preco: 23.13, desc: 'Lixar + Fundo + 2 dem√£os fosco' },
                { nome: 'Drywall Massa Emendas + 2 Fosco', un: 'm¬≤', preco: 29.20, desc: 'Fundo + Massa emendas + 2 fosco' },
                { nome: 'Drywall Massa Geral + 2 Fosco', un: 'm¬≤', preco: 39.46, desc: 'Fundo + Massa geral + 2 fosco' },
                { nome: 'Drywall Massa Emendas + 2 Acetinado', un: 'm¬≤', preco: 34.64, desc: 'Fundo + Massa emendas + 2 acetinado' },
                { nome: 'Drywall Massa Geral + 2 Acetinado', un: 'm¬≤', preco: 44.85, desc: 'Fundo + Massa geral + 2 acetinado' },
                { nome: 'Drywall Massa Emendas + 2 Semi-Brilho', un: 'm¬≤', preco: 45.47, desc: 'Fundo + Massa emendas + 2 semi-brilho' },
                { nome: 'Drywall Massa Geral + 2 Semi-Brilho', un: 'm¬≤', preco: 44.91, desc: 'Fundo + Massa geral + 2 semi-brilho' },
                
                // EXTERNOS
                { nome: 'Pintura Muro Externo', un: 'm¬≤', preco: 16.50, desc: '2 dem√£os acr√≠lica externa' },
                { nome: 'Pintura Fachada at√© 3m', un: 'm¬≤', preco: 18.80, desc: 'Acr√≠lica externa' },
                { nome: 'Pintura Fachada acima 3m', un: 'm¬≤', preco: 24.50, desc: 'Acr√≠lica externa com andaime' },
                { nome: 'Textura R√∫stica', un: 'm¬≤', preco: 28.00, desc: 'Textura grafiato/r√∫stica' },
                { nome: 'Textura Lisa', un: 'm¬≤', preco: 22.50, desc: 'Textura lisa rolada' },
                
                // PORTAS E JANELAS
                { nome: 'Pintura Porta Lisa', un: 'un', preco: 85.00, desc: 'Porta lisa dos dois lados' },
                { nome: 'Pintura Porta Frisada', un: 'un', preco: 120.00, desc: 'Porta frisada dos dois lados' },
                { nome: 'Pintura Janela Madeira P', un: 'un', preco: 95.00, desc: 'Janela pequena' },
                { nome: 'Pintura Janela Madeira M', un: 'un', preco: 145.00, desc: 'Janela m√©dia' },
                { nome: 'Pintura Janela Madeira G', un: 'un', preco: 195.00, desc: 'Janela grande' },
                { nome: 'Pintura Grade/Port√£o P', un: 'un', preco: 150.00, desc: 'Grade ou port√£o pequeno' },
                { nome: 'Pintura Grade/Port√£o M', un: 'un', preco: 280.00, desc: 'Grade ou port√£o m√©dio' },
                { nome: 'Pintura Grade/Port√£o G', un: 'un', preco: 450.00, desc: 'Grade ou port√£o grande' },
                
                // TETO
                { nome: 'Pintura Teto Repintura', un: 'm¬≤', preco: 12.50, desc: 'Apenas repintura' },
                { nome: 'Pintura Teto Selador + 2 dem√£os', un: 'm¬≤', preco: 18.00, desc: 'Selador + 2 dem√£os' },
                { nome: 'Pintura Teto com Massa', un: 'm¬≤', preco: 32.00, desc: 'Selador + Massa + 2 dem√£os' },
                
                // DESLOCAMENTO
                { nome: 'Deslocamento por KM', un: 'un', preco: 8.11, desc: 'Por quil√¥metro rodado' }
            ];

            await db.servicos.bulkAdd(servicos);

            // CLIENTES
            const clientes = [
                { nome: 'Jo√£o Silva Santos', doc: '123.456.789-00', tel: '(11) 99876-5432', email: 'joao.silva@email.com', end: 'Rua das Flores, 123 - Vila Nova, S√£o Paulo - SP', obs: 'Cliente antigo, sempre paga em dia' },
                { nome: 'Maria Oliveira Costa', doc: '234.567.890-11', tel: '(11) 98765-4321', email: 'maria.oliveira@email.com', end: 'Av. Brasil, 456 - Centro, S√£o Paulo - SP', obs: 'Prefere pagamento parcelado' },
                { nome: 'Carlos Eduardo Ferreira', doc: '345.678.901-22', tel: '(11) 97654-3210', email: 'carlos.ferreira@email.com', end: 'Rua dos Pinheiros, 789 - Pinheiros, S√£o Paulo - SP', obs: '' },
                { nome: 'Ana Paula Rodrigues', doc: '456.789.012-33', tel: '(11) 96543-2109', email: 'ana.rodrigues@email.com', end: 'Rua Augusta, 321 - Consola√ß√£o, S√£o Paulo - SP', obs: 'Indica√ß√£o do Jo√£o Silva' },
                { nome: 'Pedro Henrique Almeida', doc: '567.890.123-44', tel: '(11) 95432-1098', email: 'pedro.almeida@email.com', end: 'Av. Paulista, 1000 - Bela Vista, S√£o Paulo - SP', obs: 'Apartamento de alto padr√£o' },
                { nome: 'Fernanda Lima Souza', doc: '678.901.234-55', tel: '(11) 94321-0987', email: 'fernanda.souza@email.com', end: 'Rua Oscar Freire, 555 - Jardins, S√£o Paulo - SP', obs: '' },
                { nome: 'Ricardo Mendes Neto', doc: '789.012.345-66', tel: '(11) 93210-9876', email: 'ricardo.mendes@email.com', end: 'Alameda Santos, 888 - Cerqueira C√©sar, S√£o Paulo - SP', obs: 'Escrit√≥rio comercial' },
                { nome: 'Juliana Martins Pereira', doc: '890.123.456-77', tel: '(11) 92109-8765', email: 'juliana.martins@email.com', end: 'Rua Haddock Lobo, 222 - Jardim Paulista, S√£o Paulo - SP', obs: '' },
                { nome: 'Marcos Ant√¥nio Ribeiro', doc: '901.234.567-88', tel: '(11) 91098-7654', email: 'marcos.ribeiro@email.com', end: 'Av. Rebou√ßas, 3333 - Pinheiros, S√£o Paulo - SP', obs: 'Pr√©dio comercial' },
                { nome: 'Patr√≠cia Gomes Cardoso', doc: '012.345.678-99', tel: '(11) 90987-6543', email: 'patricia.cardoso@email.com', end: 'Rua da Consola√ß√£o, 444 - Consola√ß√£o, S√£o Paulo - SP', obs: '' },
                { nome: 'Lucas Fernandes Silva', doc: '111.222.333-44', tel: '(11) 99111-2222', email: 'lucas.fernandes@email.com', end: 'Rua Vergueiro, 1500 - Vila Mariana, S√£o Paulo - SP', obs: 'Casa t√©rrea' },
                { nome: 'Camila Rocha Dias', doc: '222.333.444-55', tel: '(11) 98222-3333', email: 'camila.rocha@email.com', end: 'Av. Ibirapuera, 2500 - Moema, S√£o Paulo - SP', obs: '' },
                { nome: 'Bruno Costa Machado', doc: '333.444.555-66', tel: '(11) 97333-4444', email: 'bruno.costa@email.com', end: 'Rua Pamplona, 666 - Jardim Paulista, S√£o Paulo - SP', obs: 'Cobertura duplex' },
                { nome: 'Amanda Freitas Lopes', doc: '444.555.666-77', tel: '(11) 96444-5555', email: 'amanda.freitas@email.com', end: 'Alameda Ja√∫, 777 - Jardim Paulista, S√£o Paulo - SP', obs: '' },
                { nome: 'Thiago Alves Moreira', doc: '555.666.777-88', tel: '(11) 95555-6666', email: 'thiago.alves@email.com', end: 'Rua Estados Unidos, 888 - Jardim Am√©rica, S√£o Paulo - SP', obs: 'Reforma completa' },
                { nome: 'Larissa Santos Ara√∫jo', doc: '666.777.888-99', tel: '(11) 94666-7777', email: 'larissa.santos@email.com', end: 'Av. Europa, 999 - Jardim Europa, S√£o Paulo - SP', obs: '' },
                { nome: 'Felipe Barbosa Lima', doc: '777.888.999-00', tel: '(11) 93777-8888', email: 'felipe.barbosa@email.com', end: 'Rua Groenl√¢ndia, 111 - Jardim Am√©rica, S√£o Paulo - SP', obs: 'Casa de 3 andares' },
                { nome: 'Mariana Teixeira Ramos', doc: '888.999.000-11', tel: '(11) 92888-9999', email: 'mariana.teixeira@email.com', end: 'Alameda Lorena, 222 - Jardins, S√£o Paulo - SP', obs: '' },
                { nome: 'Gustavo Pereira Nunes', doc: '999.000.111-22', tel: '(11) 91999-0000', email: 'gustavo.pereira@email.com', end: 'Rua Bela Cintra, 333 - Consola√ß√£o, S√£o Paulo - SP', obs: 'Apartamento 150m¬≤' },
                { nome: 'Isabela Cunha Monteiro', doc: '000.111.222-33', tel: '(11) 90000-1111', email: 'isabela.cunha@email.com', end: 'Av. Cidade Jardim, 444 - Itaim Bibi, S√£o Paulo - SP', obs: '' },
                { nome: 'Rafael Campos Duarte', doc: '112.233.445-56', tel: '(11) 99112-2334', email: 'rafael.campos@email.com', end: 'Rua Funchal, 555 - Vila Ol√≠mpia, S√£o Paulo - SP', obs: 'Sala comercial' },
                { nome: 'Beatriz Moura Vieira', doc: '223.344.556-67', tel: '(11) 98223-3445', email: 'beatriz.moura@email.com', end: 'Av. Faria Lima, 666 - Pinheiros, S√£o Paulo - SP', obs: '' },
                { nome: 'Andr√© Luiz Correia', doc: '334.455.667-78', tel: '(11) 97334-4556', email: 'andre.correia@email.com', end: 'Rua Joaquim Floriano, 777 - Itaim Bibi, S√£o Paulo - SP', obs: 'Empresa de TI' },
                { nome: 'Carolina Pinto Azevedo', doc: '445.566.778-89', tel: '(11) 96445-5667', email: 'carolina.pinto@email.com', end: 'Alameda Gabriel Monteiro da Silva, 888 - Jardins, S√£o Paulo - SP', obs: '' },
                { nome: 'Diego Santana Reis', doc: '556.677.889-90', tel: '(11) 95556-6778', email: 'diego.santana@email.com', end: 'Rua Tabapu√£, 999 - Itaim Bibi, S√£o Paulo - SP', obs: 'Loja de roupas' },
                { nome: 'Let√≠cia Carvalho Melo', doc: '667.788.990-01', tel: '(11) 94667-7889', email: 'leticia.carvalho@email.com', end: 'Av. Brigadeiro Faria Lima, 1010 - Pinheiros, S√£o Paulo - SP', obs: '' },
                { nome: 'Vin√≠cius Ramos Castro', doc: '778.899.001-12', tel: '(11) 93778-8990', email: 'vinicius.ramos@email.com', end: 'Rua Leopoldo Couto Magalh√£es Jr, 1111 - Itaim Bibi, S√£o Paulo - SP', obs: 'Cl√≠nica m√©dica' },
                { nome: 'Nat√°lia Borges Prado', doc: '889.900.112-23', tel: '(11) 92889-9001', email: 'natalia.borges@email.com', end: 'Alameda Itu, 1212 - Jardim Paulista, S√£o Paulo - SP', obs: '' },
                { nome: 'Eduardo Fonseca Dias', doc: '990.011.223-34', tel: '(11) 91990-0112', email: 'eduardo.fonseca@email.com', end: 'Rua Peixoto Gomide, 1313 - Jardins, S√£o Paulo - SP', obs: 'Restaurante' },
                { nome: 'Vanessa Lima Nogueira', doc: '001.122.334-45', tel: '(11) 90001-1223', email: 'vanessa.lima@email.com', end: 'Av. Santo Amaro, 1414 - Vila Nova Concei√ß√£o, S√£o Paulo - SP', obs: '' },
                { nome: 'Roberto Maia Gomes', doc: '113.224.335-46', tel: '(11) 99113-2243', email: 'roberto.maia@email.com', end: 'Rua Normandia, 1515 - Vila Madalena, S√£o Paulo - SP', obs: 'Est√∫dio de m√∫sica' },
                { nome: 'Aline Vasconcelos Cruz', doc: '224.335.446-57', tel: '(11) 98224-3354', email: 'aline.vasconcelos@email.com', end: 'Rua Aspicuelta, 1616 - Vila Madalena, S√£o Paulo - SP', obs: '' },
                { nome: 'Henrique Barros Leal', doc: '335.446.557-68', tel: '(11) 97335-4465', email: 'henrique.barros@email.com', end: 'Rua Harmonia, 1717 - Vila Madalena, S√£o Paulo - SP', obs: 'Galeria de arte' },
                { nome: 'Renata Silveira Matos', doc: '446.557.668-79', tel: '(11) 96446-5576', email: 'renata.silveira@email.com', end: 'Rua Fidalga, 1818 - Vila Madalena, S√£o Paulo - SP', obs: '' },
                { nome: 'F√°bio Miranda Teles', doc: '557.668.779-80', tel: '(11) 95557-6687', email: 'fabio.miranda@email.com', end: 'Rua Mourato Coelho, 1919 - Pinheiros, S√£o Paulo - SP', obs: 'Bar e restaurante' },
                { nome: 'Priscila Andrade Faria', doc: '668.779.880-91', tel: '(11) 94668-7798', email: 'priscila.andrade@email.com', end: 'Rua dos Pinheiros, 2020 - Pinheiros, S√£o Paulo - SP', obs: '' },
                { nome: 'S√©rgio Neves Guimar√£es', doc: '779.880.991-02', tel: '(11) 93779-8809', email: 'sergio.neves@email.com', end: 'Rua Teodoro Sampaio, 2121 - Pinheiros, S√£o Paulo - SP', obs: 'Escrit√≥rio advocacia' },
                { nome: 'D√©bora Costa Amaral', doc: '880.991.002-13', tel: '(11) 92880-9910', email: 'debora.costa@email.com', end: 'Rua Cardeal Arcoverde, 2222 - Pinheiros, S√£o Paulo - SP', obs: '' },
                { nome: 'Leandro Pires Machado', doc: '991.002.113-24', tel: '(11) 91991-0021', email: 'leandro.pires@email.com', end: 'Av. Henrique Schaumann, 2323 - Pinheiros, S√£o Paulo - SP', obs: 'Academia' },
                { nome: 'Tatiane Sousa Ribeiro', doc: '002.113.224-35', tel: '(11) 90002-1132', email: 'tatiane.sousa@email.com', end: 'Rua Artur de Azevedo, 2424 - Pinheiros, S√£o Paulo - SP', obs: 'Sal√£o de beleza' }
            ];

            await db.clientes.bulkAdd(clientes);

            // OR√áAMENTOS
            const hoje = new Date();
            const orcamentos = [
                {
                    clienteId: 1,
                    titulo: 'Pintura Apartamento Completo',
                    itens: [
                        { servId: 42, nome: 'Selador + Massa Acr√≠lica + 2 Acr√≠lica', preco: 28.50, un: 'm¬≤', qtd: 180, total: 5130 },
                        { servId: 69, nome: 'Pintura Teto com Massa', preco: 32.00, un: 'm¬≤', qtd: 65, total: 2080 },
                        { servId: 61, nome: 'Pintura Porta Lisa', preco: 85.00, un: 'un', qtd: 6, total: 510 }
                    ],
                    total: 7720,
                    status: 'fechado',
                    data: new Date(hoje.getTime() - 45 * 24 * 60 * 60 * 1000).toISOString(),
                    val: 15
                },
                {
                    clienteId: 2,
                    titulo: 'Pintura Externa Casa',
                    itens: [
                        { servId: 57, nome: 'Pintura Fachada at√© 3m', preco: 18.80, un: 'm¬≤', qtd: 120, total: 2256 },
                        { servId: 56, nome: 'Pintura Muro Externo', preco: 16.50, un: 'm¬≤', qtd: 85, total: 1402.50 },
                        { servId: 66, nome: 'Pintura Grade/Port√£o M', preco: 280.00, un: 'un', qtd: 1, total: 280 }
                    ],
                    total: 3938.50,
                    status: 'fechado',
                    data: new Date(hoje.getTime() - 40 * 24 * 60 * 60 * 1000).toISOString(),
                    val: 15
                },
                {
                    clienteId: 5,
                    titulo: 'Reforma Cobertura Duplex',
                    itens: [
                        { servId: 44, nome: 'Selador + 3 Massa + 2 Acr√≠lica Acetinado', preco: 48.28, un: 'm¬≤', qtd: 320, total: 15449.60 },
                        { servId: 69, nome: 'Pintura Teto com Massa', preco: 32.00, un: 'm¬≤', qtd: 150, total: 4800 },
                        { servId: 62, nome: 'Pintura Porta Frisada', preco: 120.00, un: 'un', qtd: 12, total: 1440 },
                        { servId: 59, nome: 'Textura R√∫stica', preco: 28.00, un: 'm¬≤', qtd: 45, total: 1260 }
                    ],
                    total: 22949.60,
                    status: 'fechado',
                    data: new Date(hoje.getTime() - 35 * 24 * 60 * 60 * 1000).toISOString(),
                    val: 15
                },
                {
                    clienteId: 8,
                    titulo: 'Escrit√≥rio Comercial',
                    itens: [
                        { servId: 48, nome: 'Drywall Fundo + 2 Fosco', preco: 23.13, un: 'm¬≤', qtd: 200, total: 4626 },
                        { servId: 68, nome: 'Pintura Teto Selador + 2 dem√£os', preco: 18.00, un: 'm¬≤', qtd: 85, total: 1530 }
                    ],
                    total: 6156,
                    status: 'fechado',
                    data: new Date(hoje.getTime() - 30 * 24 * 60 * 60 * 1000).toISOString(),
                    val: 15
                },
                {
                    clienteId: 12,
                    titulo: 'Pintura Sala e Quartos',
                    itens: [
                        { servId: 40, nome: 'Selador + 2 Acr√≠lica Fosca', preco: 15.30, un: 'm¬≤', qtd: 95, total: 1453.50 },
                        { servId: 67, nome: 'Pintura Teto Repintura', preco: 12.50, un: 'm¬≤', qtd: 40, total: 500 }
                    ],
                    total: 1953.50,
                    status: 'fechado',
                    data: new Date(hoje.getTime() - 25 * 24 * 60 * 60 * 1000).toISOString(),
                    val: 15
                },
                {
                    clienteId: 15,
                    titulo: 'Reforma Completa Apartamento 200m¬≤',
                    itens: [
                        { servId: 46, nome: 'Selador + 2 Massa + 2 Acr√≠lica Semi-Brilho', preco: 49.90, un: 'm¬≤', qtd: 280, total: 13972 },
                        { servId: 69, nome: 'Pintura Teto com Massa', preco: 32.00, un: 'm¬≤', qtd: 95, total: 3040 },
                        { servId: 62, nome: 'Pintura Porta Frisada', preco: 120.00, un: 'un', qtd: 8, total: 960 },
                        { servId: 64, nome: 'Pintura Janela Madeira M', preco: 145.00, un: 'un', qtd: 5, total: 725 }
                    ],
                    total: 18697,
                    status: 'fechado',
                    data: new Date(hoje.getTime() - 20 * 24 * 60 * 60 * 1000).toISOString(),
                    val: 15
                },
                {
                    clienteId: 18,
                    titulo: 'Cl√≠nica M√©dica - Recep√ß√£o',
                    itens: [
                        { servId: 52, nome: 'Drywall Massa Geral + 2 Acetinado', preco: 44.85, un: 'm¬≤', qtd: 85, total: 3812.25 },
                        { servId: 68, nome: 'Pintura Teto Selador + 2 dem√£os', preco: 18.00, un: 'm¬≤', qtd: 45, total: 810 }
                    ],
                    total: 4622.25,
                    status: 'fechado',
                    data: new Date(hoje.getTime() - 15 * 24 * 60 * 60 * 1000).toISOString(),
                    val: 15
                },
                {
                    clienteId: 22,
                    titulo: 'Pintura Restaurante',
                    itens: [
                        { servId: 42, nome: 'Selador + Massa Acr√≠lica + 2 Acr√≠lica', preco: 28.50, un: 'm¬≤', qtd: 150, total: 4275 },
                        { servId: 69, nome: 'Pintura Teto com Massa', preco: 32.00, un: 'm¬≤', qtd: 70, total: 2240 },
                        { servId: 7, nome: 'Lavagem Tijolinho', preco: 5.16, un: 'm¬≤', qtd: 25, total: 129 }
                    ],
                    total: 6644,
                    status: 'fechado',
                    data: new Date(hoje.getTime() - 10 * 24 * 60 * 60 * 1000).toISOString(),
                    val: 15
                },
                {
                    clienteId: 25,
                    titulo: 'Loja de Roupas - Shopping',
                    itens: [
                        { servId: 48, nome: 'Drywall Fundo + 2 Fosco', preco: 23.13, un: 'm¬≤', qtd: 120, total: 2775.60 },
                        { servId: 61, nome: 'Pintura Porta Lisa', preco: 85.00, un: 'un', qtd: 2, total: 170 }
                    ],
                    total: 2945.60,
                    status: 'pendente',
                    data: new Date(hoje.getTime() - 7 * 24 * 60 * 60 * 1000).toISOString(),
                    val: 15
                },
                {
                    clienteId: 28,
                    titulo: 'Apartamento Pequeno 60m¬≤',
                    itens: [
                        { servId: 36, nome: 'Selador + Massa PVA + 2 L√°tex', preco: 22.50, un: 'm¬≤', qtd: 85, total: 1912.50 },
                        { servId: 67, nome: 'Pintura Teto Repintura', preco: 12.50, un: 'm¬≤', qtd: 55, total: 687.50 }
                    ],
                    total: 2600,
                    status: 'pendente',
                    data: new Date(hoje.getTime() - 5 * 24 * 60 * 60 * 1000).toISOString(),
                    val: 15
                },
                {
                    clienteId: 31,
                    titulo: 'Galeria de Arte',
                    itens: [
                        { servId: 52, nome: 'Drywall Massa Geral + 2 Acetinado', preco: 44.85, un: 'm¬≤', qtd: 180, total: 8073 },
                        { servId: 68, nome: 'Pintura Teto Selador + 2 dem√£os', preco: 18.00, un: 'm¬≤', qtd: 90, total: 1620 }
                    ],
                    total: 9693,
                    status: 'pendente',
                    data: new Date(hoje.getTime() - 4 * 24 * 60 * 60 * 1000).toISOString(),
                    val: 15
                },
                {
                    clienteId: 35,
                    titulo: 'Bar e Restaurante - Fachada',
                    itens: [
                        { servId: 58, nome: 'Pintura Fachada acima 3m', preco: 24.50, un: 'm¬≤', qtd: 75, total: 1837.50 },
                        { servId: 66, nome: 'Pintura Grade/Port√£o M', preco: 280.00, un: 'un', qtd: 2, total: 560 },
                        { servId: 15, nome: 'Lavagem Parede at√© 3m', preco: 4.54, un: 'm¬≤', qtd: 75, total: 340.50 }
                    ],
                    total: 2738,
                    status: 'pendente',
                    data: new Date(hoje.getTime() - 3 * 24 * 60 * 60 * 1000).toISOString(),
                    val: 15
                },
                {
                    clienteId: 38,
                    titulo: 'Escrit√≥rio Advocacia',
                    itens: [
                        { servId: 44, nome: 'Selador + 3 Massa + 2 Acr√≠lica Acetinado', preco: 48.28, un: 'm¬≤', qtd: 110, total: 5310.80 },
                        { servId: 69, nome: 'Pintura Teto com Massa', preco: 32.00, un: 'm¬≤', qtd: 55, total: 1760 },
                        { servId: 62, nome: 'Pintura Porta Frisada', preco: 120.00, un: 'un', qtd: 4, total: 480 }
                    ],
                    total: 7550.80,
                    status: 'recusado',
                    data: new Date(hoje.getTime() - 8 * 24 * 60 * 60 * 1000).toISOString(),
                    val: 15
                },
                {
                    clienteId: 40,
                    titulo: 'Sal√£o de Beleza - Reforma',
                    itens: [
                        { servId: 42, nome: 'Selador + Massa Acr√≠lica + 2 Acr√≠lica', preco: 28.50, un: 'm¬≤', qtd: 65, total: 1852.50 },
                        { servId: 67, nome: 'Pintura Teto Repintura', preco: 12.50, un: 'm¬≤', qtd: 35, total: 437.50 },
                        { servId: 61, nome: 'Pintura Porta Lisa', preco: 85.00, un: 'un', qtd: 3, total: 255 }
                    ],
                    total: 2545,
                    status: 'pendente',
                    data: new Date(hoje.getTime() - 1 * 24 * 60 * 60 * 1000).toISOString(),
                    val: 15
                },
                {
                    clienteId: 3,
                    titulo: 'Casa T√©rrea - Pintura Completa',
                    itens: [
                        { servId: 42, nome: 'Selador + Massa Acr√≠lica + 2 Acr√≠lica', preco: 28.50, un: 'm¬≤', qtd: 220, total: 6270 },
                        { servId: 69, nome: 'Pintura Teto com Massa', preco: 32.00, un: 'm¬≤', qtd: 95, total: 3040 },
                        { servId: 56, nome: 'Pintura Muro Externo', preco: 16.50, un: 'm¬≤', qtd: 65, total: 1072.50 },
                        { servId: 66, nome: 'Pintura Grade/Port√£o M', preco: 280.00, un: 'un', qtd: 1, total: 280 }
                    ],
                    total: 10662.50,
                    status: 'recusado',
                    data: new Date(hoje.getTime() - 12 * 24 * 60 * 60 * 1000).toISOString(),
                    val: 15
                }
            ];

            await db.orcamentos.bulkAdd(orcamentos);

            // PERFIL
            await db.perfil.add({
                nome: 'Painel Services',
                doc: '12.345.678/0001-99',
                tel: '(11) 99999-8888',
                email: 'contato@painelservices.com.br',
                end: 'S√£o Paulo - SP',
                val: 15
            });

            console.log('Database populado com sucesso!');
        }

        document.addEventListener('DOMContentLoaded', async () => {
            await seedDatabase();
            loadDashboard();
        });
    </script>
</body>
</html>
=======
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#1a3b5a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>PS Pro - Or√ßamentos Inteligentes</title>
    <link rel="manifest" href="manifest.json">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/dexie@3.2.4/dist/dexie.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root {
            --azul: #1a3b5a;
            --azul-medio: #2a5580;
            --amarelo: #f7c026;
            --amarelo-hover: #e5af1e;
            --branco: #ffffff;
            --cinza-bg: #f5f7fa;
            --cinza-borda: #e0e5eb;
            --cinza-texto: #6b7280;
            --verde: #22c55e;
            --vermelho: #ef4444;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Poppins', sans-serif;
            background: var(--cinza-bg);
            color: var(--azul);
            min-height: 100vh;
            padding-bottom: 90px;
        }
        .header {
            background: linear-gradient(135deg, var(--azul) 0%, var(--azul-medio) 100%);
            padding: 20px;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .header-content { display: flex; align-items: center; justify-content: space-between; }
        .logo { display: flex; align-items: center; gap: 12px; }
        .logo-icon {
            width: 45px; height: 45px;
            background: var(--branco);
            border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            font-weight: 800; font-size: 14px;
            position: relative;
        }
        .logo-icon span:first-child { color: var(--azul); position: absolute; top: 6px; left: 8px; font-size: 18px; }
        .logo-icon span:last-child { color: var(--amarelo); position: absolute; bottom: 4px; right: 6px; font-size: 16px; }
        .logo-text { color: var(--branco); }
        .logo-text h1 { font-size: 22px; font-weight: 700; }
        .logo-text span { font-size: 11px; opacity: 0.85; }
        .header-btn {
            width: 42px; height: 42px;
            background: rgba(255,255,255,0.15);
            border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            color: var(--branco);
            cursor: pointer;
            border: none;
        }
        .bottom-nav {
            position: fixed;
            bottom: 0; left: 0; right: 0;
            background: var(--branco);
            padding: 10px 15px 25px;
            display: flex;
            justify-content: space-around;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.1);
            z-index: 1000;
            border-radius: 24px 24px 0 0;
        }
        .nav-item {
            display: flex; flex-direction: column; align-items: center; gap: 4px;
            padding: 8px 14px;
            border-radius: 14px;
            cursor: pointer;
            color: var(--cinza-texto);
            transition: all 0.2s;
        }
        .nav-item.active {
            background: linear-gradient(135deg, var(--azul) 0%, var(--azul-medio) 100%);
            color: var(--branco);
        }
        .nav-item svg { width: 22px; height: 22px; }
        .nav-item span { font-size: 10px; font-weight: 500; }
        .main { padding: 20px; max-width: 500px; margin: 0 auto; }
        .page { display: none; animation: fadeIn 0.3s; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .card {
            background: var(--branco);
            border-radius: 16px;
            padding: 18px;
            margin-bottom: 14px;
            box-shadow: 0 2px 10px rgba(26,59,90,0.08);
        }
        .card-title { font-size: 15px; font-weight: 600; margin-bottom: 14px; }
        .stats-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 16px; }
        .stat-card {
            background: var(--branco);
            border-radius: 14px;
            padding: 16px;
            box-shadow: 0 2px 10px rgba(26,59,90,0.08);
        }
        .stat-card.highlight {
            background: linear-gradient(135deg, var(--azul) 0%, var(--azul-medio) 100%);
            color: var(--branco);
        }
        .stat-card.success { border-left: 4px solid var(--verde); }
        .stat-card.warning { border-left: 4px solid var(--amarelo); }
        .stat-value { font-size: 22px; font-weight: 700; }
        .stat-label { font-size: 11px; color: var(--cinza-texto); margin-top: 4px; }
        .stat-card.highlight .stat-label { color: rgba(255,255,255,0.8); }
        .btn {
            display: flex; align-items: center; justify-content: center; gap: 8px;
            padding: 14px 20px;
            border-radius: 12px;
            font-family: 'Poppins', sans-serif;
            font-size: 14px; font-weight: 600;
            border: none;
            cursor: pointer;
            width: 100%;
            transition: all 0.2s;
        }
        .btn-primary { background: var(--amarelo); color: var(--azul); }
        .btn-primary:hover { background: var(--amarelo-hover); transform: translateY(-2px); }
        .btn-secondary { background: var(--azul); color: var(--branco); }
        .btn-outline { background: transparent; border: 2px solid var(--azul); color: var(--azul); }
        .btn-sm { padding: 10px 16px; font-size: 13px; width: auto; }
        .form-group { margin-bottom: 14px; }
        .form-label { display: block; font-size: 12px; font-weight: 500; margin-bottom: 6px; }
        .form-input, .form-select {
            width: 100%;
            padding: 12px 14px;
            border: 2px solid var(--cinza-borda);
            border-radius: 10px;
            font-family: 'Poppins', sans-serif;
            font-size: 14px;
            background: var(--branco);
        }
        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--amarelo);
        }
        .form-row { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
        .list-item {
            display: flex; align-items: center;
            padding: 14px;
            background: var(--branco);
            border-radius: 12px;
            margin-bottom: 10px;
            box-shadow: 0 2px 8px rgba(26,59,90,0.06);
            cursor: pointer;
            transition: all 0.2s;
        }
        .list-item:hover { transform: translateX(4px); }
        .list-icon {
            width: 42px; height: 42px;
            border-radius: 10px;
            background: var(--cinza-bg);
            display: flex; align-items: center; justify-content: center;
            margin-right: 12px;
            color: var(--azul);
        }
        .list-info { flex: 1; }
        .list-title { font-size: 14px; font-weight: 600; }
        .list-sub { font-size: 11px; color: var(--cinza-texto); }
        .list-value { font-size: 14px; font-weight: 700; }
        .badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 20px;
            font-size: 10px;
            font-weight: 600;
            margin-top: 4px;
        }
        .badge-pending { background: rgba(247,192,38,0.2); color: #b8860b; }
        .badge-approved { background: rgba(34,197,94,0.2); color: #16a34a; }
        .badge-rejected { background: rgba(239,68,68,0.2); color: #dc2626; }
        .section-title {
            font-size: 16px; font-weight: 700;
            margin-bottom: 14px;
            display: flex; align-items: center; justify-content: space-between;
        }
        .section-title a { font-size: 12px; color: var(--amarelo); text-decoration: none; }
        .quick-actions { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 16px; }
        .quick-action {
            background: var(--branco);
            border-radius: 14px;
            padding: 18px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 2px 10px rgba(26,59,90,0.08);
        }
        .quick-action:hover { transform: translateY(-3px); box-shadow: 0 4px 15px rgba(26,59,90,0.12); }
        .quick-action svg { width: 28px; height: 28px; color: var(--amarelo); margin-bottom: 8px; }
        .quick-action span { display: block; font-size: 12px; font-weight: 600; }
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(26,59,90,0.6);
            backdrop-filter: blur(4px);
            display: none;
            align-items: center; justify-content: center;
            z-index: 2000;
            padding: 20px;
        }
        .modal-overlay.active { display: flex; }
        .modal {
            background: var(--branco);
            border-radius: 16px;
            width: 100%;
            max-width: 420px;
            max-height: 85vh;
            overflow-y: auto;
            animation: modalIn 0.3s;
        }
        @keyframes modalIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .modal-header {
            padding: 18px;
            border-bottom: 1px solid var(--cinza-borda);
            display: flex; align-items: center; justify-content: space-between;
        }
        .modal-title { font-size: 16px; font-weight: 700; }
        .modal-close {
            width: 32px; height: 32px;
            border-radius: 8px;
            background: var(--cinza-bg);
            display: flex; align-items: center; justify-content: center;
            cursor: pointer;
            border: none;
        }
        .modal-body { padding: 18px; }
        .modal-footer {
            padding: 14px 18px;
            border-top: 1px solid var(--cinza-borda);
            display: flex; gap: 10px;
        }
        .modal-footer .btn { flex: 1; }
        .search-box { position: relative; margin-bottom: 14px; }
        .search-box input { padding-left: 40px; }
        .search-box svg { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--cinza-texto); width: 18px; height: 18px; }
        .empty-state { text-align: center; padding: 40px 20px; }
        .empty-state svg { width: 60px; height: 60px; color: var(--cinza-borda); margin-bottom: 14px; }
        .empty-state h3 { font-size: 16px; margin-bottom: 6px; }
        .empty-state p { font-size: 13px; color: var(--cinza-texto); margin-bottom: 16px; }
        .top-item {
            display: flex; align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid var(--cinza-bg);
        }
        .top-item:last-child { border-bottom: none; }
        .top-rank {
            width: 26px; height: 26px;
            border-radius: 8px;
            background: var(--amarelo);
            color: var(--azul);
            display: flex; align-items: center; justify-content: center;
            font-weight: 700; font-size: 12px;
            margin-right: 10px;
        }
        .top-info { flex: 1; }
        .top-name { font-size: 13px; font-weight: 600; }
        .top-stats { font-size: 11px; color: var(--cinza-texto); }
        .top-value { text-align: right; }
        .top-total { font-size: 13px; font-weight: 700; }
        .top-rate { font-size: 10px; color: var(--verde); }
        .orc-item {
            display: flex; align-items: center;
            padding: 10px;
            background: var(--cinza-bg);
            border-radius: 10px;
            margin-bottom: 8px;
        }
        .orc-item-info { flex: 1; }
        .orc-item-name { font-size: 13px; font-weight: 600; }
        .orc-item-det { font-size: 11px; color: var(--cinza-texto); }
        .orc-item-val { font-size: 14px; font-weight: 700; margin-right: 10px; }
        .orc-item-del {
            width: 28px; height: 28px;
            border-radius: 6px;
            background: rgba(239,68,68,0.1);
            color: var(--vermelho);
            display: flex; align-items: center; justify-content: center;
            cursor: pointer;
            border: none;
        }
        .orc-total {
            background: linear-gradient(135deg, var(--azul) 0%, var(--azul-medio) 100%);
            border-radius: 14px;
            padding: 18px;
            color: var(--branco);
            margin-top: 14px;
        }
        .orc-total-label { font-size: 12px; opacity: 0.8; }
        .orc-total-value { font-size: 28px; font-weight: 800; }
        .toast {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--azul);
            color: var(--branco);
            padding: 12px 20px;
            border-radius: 10px;
            font-size: 13px;
            z-index: 3000;
            opacity: 0;
            transition: all 0.3s;
        }
        .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }
        .autocomplete-wrapper { position: relative; }
        .autocomplete-list {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--branco);
            border: 2px solid var(--cinza-borda);
            border-top: none;
            border-radius: 0 0 10px 10px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 100;
            display: none;
        }
        .autocomplete-list.show { display: block; }
        .autocomplete-item {
            padding: 10px 14px;
            cursor: pointer;
            border-bottom: 1px solid var(--cinza-bg);
            font-size: 13px;
        }
        .autocomplete-item:hover { background: var(--cinza-bg); }
        .autocomplete-item:last-child { border-bottom: none; }
        .autocomplete-item small { color: var(--cinza-texto); display: block; font-size: 11px; }
        .orc-item-edit {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .orc-item-edit input {
            width: 60px;
            padding: 4px 8px;
            border: 1px solid var(--cinza-borda);
            border-radius: 6px;
            font-size: 12px;
            text-align: center;
        }
        .orc-item-ambiente {
            background: var(--azul);
            color: var(--branco);
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            margin: 12px 0 8px 0;
        }
        .orc-item-ambiente:first-child { margin-top: 0; }
        .filters-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 12px;
        }
        .filter-group { }
        .filter-label {
            display: block;
            font-size: 11px;
            font-weight: 500;
            color: var(--cinza-texto);
            margin-bottom: 4px;
        }
        .filter-select {
            padding: 8px 10px;
            font-size: 12px;
            border-radius: 8px;
        }
        .filters-summary {
            font-size: 12px;
            color: var(--cinza-texto);
            margin-bottom: 12px;
            padding: 8px 12px;
            background: var(--cinza-bg);
            border-radius: 8px;
            display: none;
        }
        .filters-summary.show { display: block; }
        .filters-summary strong { color: var(--azul); }
        /* Remover setinhas dos inputs num√©ricos */
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type="number"] {
            -moz-appearance: textfield;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon"><span>P</span><span>S</span></div>
                <div class="logo-text">
                    <h1>PS Pro</h1>
                    <span>Or√ßamentos Inteligentes</span>
                </div>
            </div>
            <button class="header-btn" onclick="showPage('config')">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20">
                    <circle cx="12" cy="12" r="3"></circle>
                    <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                </svg>
            </button>
        </div>
    </header>

    <main class="main">
        <!-- DASHBOARD -->
        <div id="page-dashboard" class="page active">
            <div class="quick-actions">
                <div class="quick-action" onclick="openModal('modal-cliente')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                        <circle cx="12" cy="7" r="4"></circle>
                        <line x1="12" y1="11" x2="12" y2="17"></line>
                        <line x1="9" y1="14" x2="15" y2="14"></line>
                    </svg>
                    <span>Novo Cliente</span>
                </div>
                <div class="quick-action" onclick="openModal('modal-orcamento')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                        <line x1="12" y1="18" x2="12" y2="12"></line>
                        <line x1="9" y1="15" x2="15" y2="15"></line>
                    </svg>
                    <span>Novo Or√ßamento</span>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card highlight" onclick="filterOrcamentos('todos')" style="cursor:pointer;">
                    <div class="stat-value" id="stat-total">0</div>
                    <div class="stat-label">Or√ßamentos</div>
                </div>
                <div class="stat-card success" onclick="filterOrcamentos('fechado')" style="cursor:pointer;">
                    <div class="stat-value" id="stat-fechados">0</div>
                    <div class="stat-label">‚úÖ Fechados</div>
                </div>
                <div class="stat-card warning" onclick="filterOrcamentos('pendente')" style="cursor:pointer;">
                    <div class="stat-value" id="stat-pendentes">0</div>
                    <div class="stat-label">üü° Pendentes</div>
                </div>
                <div class="stat-card" style="border-left: 4px solid var(--vermelho); cursor:pointer;" onclick="filterOrcamentos('recusado')">
                    <div class="stat-value" id="stat-recusados">0</div>
                    <div class="stat-label">‚ùå Recusados</div>
                </div>
            </div>

            <div class="stat-card highlight" style="margin-bottom:16px; cursor:pointer;" onclick="filterOrcamentos('fechado')">
                <div class="stat-label">üí∞ Valor Total Fechado</div>
                <div class="stat-value" id="stat-valor">R$ 0</div>
            </div>

            <div class="section-title">
                Or√ßamentos Pendentes
                <a href="#" onclick="showPage('orcamentos');return false;">Ver todos</a>
            </div>
            <div id="ultimos-orc"></div>
        </div>

        <!-- SERVI√áOS -->
        <div id="page-servicos" class="page">
            <div class="section-title">
                Meus Servi√ßos
                <button class="btn btn-primary btn-sm" onclick="openModal('modal-servico')">+ Novo</button>
            </div>
            <div class="search-box">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                <input type="text" class="form-input" placeholder="Buscar servi√ßo..." id="search-serv" oninput="filterList('servicos')">
            </div>
            <div id="servicos-list"></div>
        </div>

        <!-- CLIENTES -->
        <div id="page-clientes" class="page">
            <div class="section-title">
                Meus Clientes
                <button class="btn btn-primary btn-sm" onclick="openModal('modal-cliente')">+ Novo</button>
            </div>
            <div class="search-box">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                <input type="text" class="form-input" placeholder="Buscar cliente..." id="search-cli" oninput="filterList('clientes')">
            </div>
            <div id="clientes-list"></div>
        </div>

        <!-- OR√áAMENTOS -->
        <div id="page-orcamentos" class="page">
            <div class="section-title">
                Meus Or√ßamentos
                <button class="btn btn-primary btn-sm" onclick="openModal('modal-orcamento')">+ Novo</button>
            </div>
            <div class="search-box">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                <input type="text" class="form-input" placeholder="Buscar or√ßamento..." id="search-orc" oninput="applyOrcFilters()">
            </div>
            <div class="filters-row">
                <div class="filter-group">
                    <label class="filter-label">Status</label>
                    <select class="form-select filter-select" id="filter-status" onchange="applyOrcFilters()">
                        <option value="">Todos</option>
                        <option value="pendente">üü° Pendente</option>
                        <option value="fechado">‚úÖ Fechado</option>
                        <option value="recusado">‚ùå Recusado</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Per√≠odo</label>
                    <select class="form-select filter-select" id="filter-periodo" onchange="applyOrcFilters()">
                        <option value="">Todo per√≠odo</option>
                        <option value="7">√öltimos 7 dias</option>
                        <option value="15">√öltimos 15 dias</option>
                        <option value="30">√öltimos 30 dias</option>
                        <option value="60">√öltimos 60 dias</option>
                        <option value="90">√öltimos 90 dias</option>
                    </select>
                </div>
            </div>
            <div class="filters-summary" id="filters-summary"></div>
            <div id="orcamentos-list"></div>
        </div>

        <!-- CONFIGURA√á√ïES -->
        <div id="page-config" class="page">
            <div class="section-title">Meu Perfil</div>
            <div class="card">
                <form id="form-perfil">
                    <div class="form-group">
                        <label class="form-label">Nome / Raz√£o Social</label>
                        <input type="text" class="form-input" id="perfil-nome" placeholder="Seu nome ou empresa">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">CPF / CNPJ</label>
                            <input type="text" class="form-input" id="perfil-doc" placeholder="000.000.000-00">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Telefone</label>
                            <input type="tel" class="form-input" id="perfil-tel" placeholder="(00) 00000-0000">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-input" id="perfil-email" placeholder="seu@email.com">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">CEP</label>
                            <input type="text" class="form-input" id="perfil-cep" placeholder="00000-000" maxlength="9" oninput="buscarCEPPerfil(this.value)">
                        </div>
                        <div class="form-group">
                            <label class="form-label">N√∫mero</label>
                            <input type="text" class="form-input" id="perfil-num" placeholder="N¬∫">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Endere√ßo</label>
                        <input type="text" class="form-input" id="perfil-end" placeholder="Rua, Bairro, Cidade - UF">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Complemento</label>
                            <input type="text" class="form-input" id="perfil-compl" placeholder="Sala, Apto...">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Validade Or√ßamentos (dias)</label>
                            <input type="number" class="form-input" id="perfil-val" value="15">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Formas de Pagamento Aceitas</label>
                        <input type="text" class="form-input" id="perfil-pagamento" placeholder="Ex: Pix, Dinheiro, Cart√£o, Transfer√™ncia">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Observa√ß√µes Padr√£o dos Or√ßamentos</label>
                        <textarea class="form-input" id="perfil-obs" rows="4" placeholder="Ex: Material n√£o incluso. Prazo de execu√ß√£o a combinar. Garantia de 1 ano..."></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Salvar Perfil</button>
                </form>
            </div>
        </div>
    </main>

    <nav class="bottom-nav">
        <div class="nav-item active" data-page="dashboard" onclick="showPage('dashboard')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>
            <span>In√≠cio</span>
        </div>
        <div class="nav-item" data-page="servicos" onclick="showPage('servicos')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path></svg>
            <span>Servi√ßos</span>
        </div>
        <div class="nav-item" data-page="clientes" onclick="showPage('clientes')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
            <span>Clientes</span>
        </div>
        <div class="nav-item" data-page="orcamentos" onclick="showPage('orcamentos')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line></svg>
            <span>Or√ßamentos</span>
        </div>
    </nav>

    <!-- Modal Servi√ßo -->
    <div class="modal-overlay" id="modal-servico">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title" id="title-servico">Novo Servi√ßo</div>
                <button class="modal-close" onclick="closeModal('modal-servico')">‚úï</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="servico-id">
                <div class="form-group">
                    <label class="form-label">Nome do Servi√ßo</label>
                    <input type="text" class="form-input" id="servico-nome" placeholder="Ex: Pintura interna">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Unidade</label>
                        <select class="form-select" id="servico-un">
                            <option value="m¬≤">m¬≤</option>
                            <option value="m">m linear</option>
                            <option value="un">unidade</option>
                            <option value="h">hora</option>
                            <option value="di√°ria">di√°ria</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Pre√ßo (R$)</label>
                        <input type="text" class="form-input" id="servico-preco" placeholder="0,00" oninput="this.value = maskMoeda(this.value)">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Descri√ß√£o (opcional)</label>
                    <input type="text" class="form-input" id="servico-desc" placeholder="Detalhes">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('modal-servico')">Cancelar</button>
                <button class="btn btn-primary" onclick="saveServico()">Salvar</button>
            </div>
        </div>
    </div>

    <!-- Modal Cliente -->
    <div class="modal-overlay" id="modal-cliente">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title" id="title-cliente">Novo Cliente</div>
                <button class="modal-close" onclick="closeModal('modal-cliente')">‚úï</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="cliente-id">
                <div class="form-group">
                    <label class="form-label">Nome Completo</label>
                    <input type="text" class="form-input" id="cliente-nome" placeholder="Nome">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">CPF/CNPJ</label>
                        <input type="text" class="form-input" id="cliente-doc" placeholder="000.000.000-00">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Telefone</label>
                        <input type="tel" class="form-input" id="cliente-tel" placeholder="(00) 00000-0000">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" id="cliente-email" placeholder="email@email.com">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">CEP</label>
                        <input type="text" class="form-input" id="cliente-cep" placeholder="00000-000" maxlength="9" oninput="buscarCEP(this.value)">
                    </div>
                    <div class="form-group">
                        <label class="form-label">N√∫mero</label>
                        <input type="text" class="form-input" id="cliente-num" placeholder="N¬∫">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Endere√ßo da Obra</label>
                    <input type="text" class="form-input" id="cliente-end" placeholder="Rua, Bairro, Cidade - UF">
                </div>
                <div class="form-group">
                    <label class="form-label">Complemento</label>
                    <input type="text" class="form-input" id="cliente-compl" placeholder="Apto, Bloco, etc.">
                </div>
                <div class="form-group">
                    <label class="form-label">Observa√ß√µes</label>
                    <input type="text" class="form-input" id="cliente-obs" placeholder="Anota√ß√µes">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('modal-cliente')">Cancelar</button>
                <button class="btn btn-primary" onclick="saveCliente()">Salvar</button>
            </div>
        </div>
    </div>

    <!-- Modal Or√ßamento -->
    <div class="modal-overlay" id="modal-orcamento">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title" id="modal-orc-title">Novo Or√ßamento</div>
                <button class="modal-close" onclick="closeModal('modal-orcamento')">‚úï</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="orc-id">
                <div class="form-group">
                    <label class="form-label">Cliente</label>
                    <div class="autocomplete-wrapper">
                        <input type="text" class="form-input" id="orc-cliente-search" placeholder="Digite para buscar cliente..." oninput="searchClientes(this.value)">
                        <input type="hidden" id="orc-cliente">
                        <div class="autocomplete-list" id="cliente-autocomplete"></div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">T√≠tulo do Or√ßamento</label>
                    <input type="text" class="form-input" id="orc-titulo" placeholder="Ex: Pintura apartamento 302">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Ambiente / Local</label>
                    <input type="text" class="form-input" id="orc-ambiente" placeholder="Ex: Sala, Quarto 1, Cozinha...">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Buscar Servi√ßo</label>
                    <div class="autocomplete-wrapper">
                        <input type="text" class="form-input" id="orc-serv-search" placeholder="Digite para buscar servi√ßo..." oninput="searchServicos(this.value)">
                        <input type="hidden" id="orc-serv-sel">
                        <div class="autocomplete-list" id="servico-autocomplete"></div>
                    </div>
                </div>
                <div class="form-row" style="grid-template-columns: 1fr 1fr 1fr;">
                    <div class="form-group">
                        <label class="form-label">Qtd</label>
                        <input type="text" class="form-input" id="orc-qtd" placeholder="0,00" oninput="this.value = maskMoeda(this.value)">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Pre√ßo Unit.</label>
                        <input type="text" class="form-input" id="orc-preco-unit" placeholder="0,00" oninput="this.value = maskMoeda(this.value)">
                    </div>
                    <div class="form-group">
                        <label class="form-label">&nbsp;</label>
                        <button type="button" class="btn btn-secondary" onclick="addItemOrc()">+ Add</button>
                    </div>
                </div>
                <div id="orc-itens"></div>
                <div class="orc-total">
                    <div class="orc-total-label">Total do Or√ßamento</div>
                    <div class="orc-total-value" id="orc-total">R$ 0,00</div>
                </div>
                <div class="form-group" style="margin-top:16px;">
                    <label class="form-label">Forma de Pagamento</label>
                    <input type="text" class="form-input" id="orc-pagamento" placeholder="Ex: 50% entrada + 50% na entrega">
                </div>
                <div class="form-group">
                    <label class="form-label">Observa√ß√µes</label>
                    <textarea class="form-input" id="orc-obs" rows="3" placeholder="Condi√ß√µes, prazos, garantias..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('modal-orcamento')">Cancelar</button>
                <button class="btn btn-primary" onclick="saveOrcamento()">Salvar</button>
            </div>
        </div>
    </div>

    <!-- Modal Detalhes -->
    <div class="modal-overlay" id="modal-det">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">Detalhes do Or√ßamento</div>
                <button class="modal-close" onclick="closeModal('modal-det')">‚úï</button>
            </div>
            <div class="modal-body" id="det-content"></div>
            <div class="modal-footer" style="flex-wrap:wrap;gap:8px;">
                <button class="btn btn-outline btn-sm" style="flex:1;min-width:70px;" onclick="setStatus('pendente')">üü° Pendente</button>
                <button class="btn btn-outline btn-sm" style="flex:1;min-width:70px;" onclick="setStatus('fechado')">‚úÖ Fechado</button>
                <button class="btn btn-outline btn-sm" style="flex:1;min-width:70px;" onclick="setStatus('recusado')">‚ùå Recusado</button>
                <button class="btn btn-secondary" style="width:100%;" onclick="editOrcamento()">‚úèÔ∏è Editar Or√ßamento</button>
                <button class="btn btn-primary" style="width:100%;" onclick="exportPDF()">üìÑ Exportar PDF</button>
            </div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script>
        const db = new Dexie('PSProDB');
        db.version(1).stores({
            perfil: '++id',
            clientes: '++id,nome',
            servicos: '++id,nome',
            orcamentos: '++id,clienteId,status,data'
        });

        let orcItens = [];
        let currentOrcId = null;

        function showPage(p) {
            document.querySelectorAll('.page').forEach(x => x.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(x => x.classList.remove('active'));
            document.getElementById('page-' + p).classList.add('active');
            document.querySelector(`.nav-item[data-page="${p}"]`)?.classList.add('active');
            if (p === 'dashboard') loadDashboard();
            if (p === 'servicos') loadServicos();
            if (p === 'clientes') loadClientes();
            if (p === 'orcamentos') loadOrcamentos();
            if (p === 'config') loadPerfil();
        }

        let isEditingOrc = false;

        async function openModal(id) {
            document.getElementById(id).classList.add('active');
            if (id === 'modal-orcamento' && !isEditingOrc) {
                orcItens = [];
                renderOrcItens();
                loadSelects();
                
                // Pr√©-preencher observa√ß√µes e pagamento do perfil
                const pArr = await db.perfil.toArray();
                if (pArr[0]) {
                    document.getElementById('orc-obs').value = pArr[0].obs || '';
                    document.getElementById('orc-pagamento').value = pArr[0].pagamento || '';
                }
            }
            isEditingOrc = false;
        }

        function closeModal(id) {
            document.getElementById(id).classList.remove('active');
            if (id === 'modal-servico') {
                document.getElementById('servico-id').value = '';
                document.getElementById('servico-nome').value = '';
                document.getElementById('servico-preco').value = '';
                document.getElementById('servico-desc').value = '';
                document.getElementById('title-servico').textContent = 'Novo Servi√ßo';
            }
            if (id === 'modal-cliente') {
                document.getElementById('cliente-id').value = '';
                document.getElementById('cliente-nome').value = '';
                document.getElementById('cliente-doc').value = '';
                document.getElementById('cliente-tel').value = '';
                document.getElementById('cliente-email').value = '';
                document.getElementById('cliente-cep').value = '';
                document.getElementById('cliente-num').value = '';
                document.getElementById('cliente-end').value = '';
                document.getElementById('cliente-compl').value = '';
                document.getElementById('cliente-obs').value = '';
                document.getElementById('title-cliente').textContent = 'Novo Cliente';
            }
            if (id === 'modal-orcamento') {
                document.getElementById('orc-id').value = '';
                document.getElementById('orc-titulo').value = '';
                document.getElementById('orc-qtd').value = '';
                document.getElementById('orc-cliente').value = '';
                document.getElementById('orc-cliente-search').value = '';
                document.getElementById('orc-serv-search').value = '';
                document.getElementById('orc-serv-sel').value = '';
                document.getElementById('orc-preco-unit').value = '';
                document.getElementById('orc-ambiente').value = '';
                document.getElementById('orc-pagamento').value = '';
                document.getElementById('orc-obs').value = '';
                document.getElementById('modal-orc-title').textContent = 'Novo Or√ßamento';
                orcItens = [];
                selectedServico = null;
                renderOrcItens();
            }
        }

        function toast(msg) {
            const t = document.getElementById('toast');
            t.textContent = msg;
            t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 2500);
        }

        // PERFIL
        async function loadPerfil() {
            const p = await db.perfil.toArray();
            if (p[0]) {
                document.getElementById('perfil-nome').value = p[0].nome || '';
                document.getElementById('perfil-doc').value = p[0].doc || '';
                document.getElementById('perfil-tel').value = p[0].tel || '';
                document.getElementById('perfil-email').value = p[0].email || '';
                document.getElementById('perfil-cep').value = p[0].cep || '';
                document.getElementById('perfil-num').value = p[0].num || '';
                document.getElementById('perfil-end').value = p[0].end || '';
                document.getElementById('perfil-compl').value = p[0].compl || '';
                document.getElementById('perfil-val').value = p[0].val || 15;
                document.getElementById('perfil-pagamento').value = p[0].pagamento || '';
                document.getElementById('perfil-obs').value = p[0].obs || '';
            }
        }

        document.getElementById('form-perfil').addEventListener('submit', async e => {
            e.preventDefault();
            
            const num = document.getElementById('perfil-num').value;
            const compl = document.getElementById('perfil-compl').value;
            let end = document.getElementById('perfil-end').value;
            
            // Monta endere√ßo completo para exibi√ß√£o
            let endCompleto = end;
            if (num && !end.includes(', ' + num)) {
                endCompleto = end.replace(/,/, ', ' + num + ',');
            }
            if (compl) {
                endCompleto += ' - ' + compl;
            }
            
            const data = {
                nome: document.getElementById('perfil-nome').value,
                doc: document.getElementById('perfil-doc').value,
                tel: document.getElementById('perfil-tel').value,
                email: document.getElementById('perfil-email').value,
                cep: document.getElementById('perfil-cep').value,
                num: num,
                end: endCompleto,
                compl: compl,
                val: document.getElementById('perfil-val').value,
                pagamento: document.getElementById('perfil-pagamento').value,
                obs: document.getElementById('perfil-obs').value
            };
            
            const ex = await db.perfil.toArray();
            if (ex[0]) await db.perfil.update(ex[0].id, data);
            else await db.perfil.add(data);
            
            toast('Perfil salvo!');
            showPage('dashboard');
        });

        // SERVI√áOS
        async function loadServicos() {
            const s = await db.servicos.toArray();
            const c = document.getElementById('servicos-list');
            if (!s.length) {
                c.innerHTML = '<div class="empty-state"><p>Nenhum servi√ßo cadastrado</p><button class="btn btn-primary" style="max-width:180px;margin:0 auto;" onclick="openModal(\'modal-servico\')">Cadastrar</button></div>';
                return;
            }
            c.innerHTML = s.map(x => `
                <div class="list-item" onclick="editServico(${x.id})">
                    <div class="list-icon"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path></svg></div>
                    <div class="list-info">
                        <div class="list-title">${x.nome}</div>
                        <div class="list-sub">${x.desc || ''}</div>
                    </div>
                    <div class="list-value">R$ ${numberToMoeda(x.preco)}/${x.un}</div>
                </div>
            `).join('');
        }

        async function editServico(id) {
            const s = await db.servicos.get(id);
            document.getElementById('servico-id').value = s.id;
            document.getElementById('servico-nome').value = s.nome;
            document.getElementById('servico-un').value = s.un;
            document.getElementById('servico-preco').value = numberToMoeda(s.preco);
            document.getElementById('servico-desc').value = s.desc || '';
            document.getElementById('title-servico').textContent = 'Editar Servi√ßo';
            openModal('modal-servico');
        }

        async function saveServico() {
            const id = document.getElementById('servico-id').value;
            const data = {
                nome: document.getElementById('servico-nome').value,
                un: document.getElementById('servico-un').value,
                preco: moedaToNumber(document.getElementById('servico-preco').value),
                desc: document.getElementById('servico-desc').value
            };
            if (!data.nome || !data.preco) { toast('Preencha nome e pre√ßo'); return; }
            if (id) await db.servicos.update(parseInt(id), data);
            else await db.servicos.add(data);
            toast('Servi√ßo salvo!');
            closeModal('modal-servico');
            loadServicos();
        }

        // CLIENTES
        async function loadClientes() {
            const c = await db.clientes.toArray();
            const el = document.getElementById('clientes-list');
            if (!c.length) {
                el.innerHTML = '<div class="empty-state"><p>Nenhum cliente cadastrado</p><button class="btn btn-primary" style="max-width:180px;margin:0 auto;" onclick="openModal(\'modal-cliente\')">Cadastrar</button></div>';
                return;
            }
            el.innerHTML = c.map(x => `
                <div class="list-item" onclick="editCliente(${x.id})">
                    <div class="list-icon"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg></div>
                    <div class="list-info">
                        <div class="list-title">${x.nome}</div>
                        <div class="list-sub">${x.tel || ''}</div>
                    </div>
                </div>
            `).join('');
        }

        async function editCliente(id) {
            const c = await db.clientes.get(id);
            document.getElementById('cliente-id').value = c.id;
            document.getElementById('cliente-nome').value = c.nome;
            document.getElementById('cliente-doc').value = c.doc || '';
            document.getElementById('cliente-tel').value = c.tel || '';
            document.getElementById('cliente-email').value = c.email || '';
            document.getElementById('cliente-cep').value = c.cep || '';
            document.getElementById('cliente-num').value = c.num || '';
            document.getElementById('cliente-end').value = c.end || '';
            document.getElementById('cliente-compl').value = c.compl || '';
            document.getElementById('cliente-obs').value = c.obs || '';
            document.getElementById('title-cliente').textContent = 'Editar Cliente';
            openModal('modal-cliente');
        }

        async function saveCliente() {
            const id = document.getElementById('cliente-id').value;
            const num = document.getElementById('cliente-num').value;
            const compl = document.getElementById('cliente-compl').value;
            let end = document.getElementById('cliente-end').value;
            
            // Adiciona n√∫mero e complemento ao endere√ßo se preenchidos
            if (num && !end.includes(', ' + num)) {
                end = end.replace(/,/, ', ' + num + ',');
            }
            if (compl) {
                end += ' - ' + compl;
            }
            
            const data = {
                nome: document.getElementById('cliente-nome').value,
                doc: document.getElementById('cliente-doc').value,
                tel: document.getElementById('cliente-tel').value,
                email: document.getElementById('cliente-email').value,
                cep: document.getElementById('cliente-cep').value,
                num: num,
                end: end,
                compl: compl,
                obs: document.getElementById('cliente-obs').value
            };
            if (!data.nome) { toast('Preencha o nome'); return; }
            if (id) await db.clientes.update(parseInt(id), data);
            else await db.clientes.add(data);
            toast('Cliente salvo!');
            closeModal('modal-cliente');
            loadClientes();
        }

        // OR√áAMENTOS
        let allClientes = [];
        let allServicos = [];
        let selectedServico = null;

        async function loadSelects() {
            allClientes = await db.clientes.toArray();
            allServicos = await db.servicos.toArray();
        }

        async function searchClientes(term) {
            const list = document.getElementById('cliente-autocomplete');
            if (!term || term.length < 2) {
                list.classList.remove('show');
                return;
            }
            const filtered = allClientes.filter(c => 
                c.nome.toLowerCase().includes(term.toLowerCase()) ||
                (c.tel && c.tel.includes(term))
            ).slice(0, 8);
            
            if (filtered.length === 0) {
                list.innerHTML = '<div class="autocomplete-item">Nenhum cliente encontrado</div>';
            } else {
                list.innerHTML = filtered.map(c => {
                    const nomeEscaped = c.nome.replace(/"/g, '&quot;').replace(/'/g, '&#39;');
                    const enderecoResumo = c.end ? c.end.substring(0, 40) + '...' : '';
                    return `
                        <div class="autocomplete-item" data-id="${c.id}" data-nome="${nomeEscaped}" onclick="selectClienteFromEl(this)">
                            <strong>${c.nome}</strong>
                            <small>${c.tel || ''} ${enderecoResumo ? '‚Ä¢ ' + enderecoResumo : ''}</small>
                        </div>
                    `;
                }).join('');
            }
            list.classList.add('show');
        }

        function selectClienteFromEl(el) {
            const id = el.dataset.id;
            const nome = el.dataset.nome;
            document.getElementById('orc-cliente').value = id;
            document.getElementById('orc-cliente-search').value = nome;
            document.getElementById('cliente-autocomplete').classList.remove('show');
        }

        function selectCliente(id, nome) {
            document.getElementById('orc-cliente').value = id;
            document.getElementById('orc-cliente-search').value = nome;
            document.getElementById('cliente-autocomplete').classList.remove('show');
        }

        async function searchServicos(term) {
            const list = document.getElementById('servico-autocomplete');
            if (!term || term.length < 2) {
                list.classList.remove('show');
                return;
            }
            const filtered = allServicos.filter(s => 
                s.nome.toLowerCase().includes(term.toLowerCase())
            ).slice(0, 8);
            
            if (filtered.length === 0) {
                list.innerHTML = '<div class="autocomplete-item">Nenhum servi√ßo encontrado</div>';
            } else {
                list.innerHTML = filtered.map(s => `
                    <div class="autocomplete-item" onclick="selectServico(${s.id})">
                        <strong>${s.nome}</strong>
                        <small>R$ ${parseFloat(s.preco).toFixed(2)} / ${s.un}</small>
                    </div>
                `).join('');
            }
            list.classList.add('show');
        }

        function selectServico(id) {
            selectedServico = allServicos.find(s => s.id === id);
            if (selectedServico) {
                document.getElementById('orc-serv-search').value = selectedServico.nome;
                document.getElementById('orc-serv-sel').value = id;
                document.getElementById('orc-preco-unit').value = numberToMoeda(selectedServico.preco);
                document.getElementById('servico-autocomplete').classList.remove('show');
                document.getElementById('orc-qtd').focus();
            }
        }

        // Fechar autocomplete ao clicar fora
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.autocomplete-wrapper')) {
                document.querySelectorAll('.autocomplete-list').forEach(l => l.classList.remove('show'));
            }
        });

        function addItemOrc() {
            const servId = document.getElementById('orc-serv-sel').value;
            const qtd = moedaToNumber(document.getElementById('orc-qtd').value);
            const precoUnit = moedaToNumber(document.getElementById('orc-preco-unit').value);
            const ambiente = document.getElementById('orc-ambiente').value.trim();
            
            if (!servId || !qtd || !precoUnit) { 
                toast('Preencha servi√ßo, quantidade e pre√ßo'); 
                return; 
            }
            
            const servico = allServicos.find(s => s.id === parseInt(servId));
            if (!servico) { toast('Servi√ßo n√£o encontrado'); return; }
            
            orcItens.push({
                servId: parseInt(servId),
                nome: servico.nome,
                preco: precoUnit,
                un: servico.un,
                qtd,
                total: qtd * precoUnit,
                ambiente: ambiente || 'Geral'
            });
            
            renderOrcItens();
            
            // Limpar campos
            document.getElementById('orc-serv-search').value = '';
            document.getElementById('orc-serv-sel').value = '';
            document.getElementById('orc-qtd').value = '';
            document.getElementById('orc-preco-unit').value = '';
            selectedServico = null;
        }

        function removeItemOrc(i) { 
            orcItens.splice(i, 1); 
            renderOrcItens(); 
        }

        function updateItemOrc(i, field, value) {
            if (field === 'qtd') {
                orcItens[i].qtd = moedaToNumber(value);
            } else if (field === 'preco') {
                orcItens[i].preco = moedaToNumber(value);
            }
            orcItens[i].total = orcItens[i].qtd * orcItens[i].preco;
            renderOrcItens();
        }

        function renderOrcItens() {
            const c = document.getElementById('orc-itens');
            const total = orcItens.reduce((s, x) => s + x.total, 0);
            
            // Agrupar por ambiente
            const ambientes = {};
            orcItens.forEach((item, i) => {
                const amb = item.ambiente || 'Geral';
                if (!ambientes[amb]) ambientes[amb] = [];
                ambientes[amb].push({...item, index: i});
            });
            
            let html = '';
            for (const [ambiente, itens] of Object.entries(ambientes)) {
                html += `<div class="orc-item-ambiente">üìç ${ambiente}</div>`;
                html += itens.map(x => `
                    <div class="orc-item">
                        <div class="orc-item-info">
                            <div class="orc-item-name">${x.nome}</div>
                            <div class="orc-item-edit">
                                <input type="text" value="${numberToMoeda(x.qtd)}" onchange="updateItemOrc(${x.index}, 'qtd', this.value)" oninput="this.value = maskMoeda(this.value)" title="Quantidade"> ${x.un} √ó
                                <input type="text" value="${numberToMoeda(x.preco)}" onchange="updateItemOrc(${x.index}, 'preco', this.value)" oninput="this.value = maskMoeda(this.value)" title="Pre√ßo unit√°rio">
                            </div>
                        </div>
                        <div class="orc-item-val">R$ ${numberToMoeda(x.total)}</div>
                        <button class="orc-item-del" onclick="removeItemOrc(${x.index})">‚úï</button>
                    </div>
                `).join('');
            }
            
            c.innerHTML = html;
            document.getElementById('orc-total').textContent = `R$ ${numberToMoeda(total)}`;
        }

        async function editOrcamento() {
            const o = await db.orcamentos.get(currentOrcId);
            if (!o) { toast('Or√ßamento n√£o encontrado'); return; }
            
            const cliente = await db.clientes.get(o.clienteId);
            
            // Carregar listas para autocomplete
            await loadSelects();
            
            // Fechar modal de detalhes
            closeModal('modal-det');
            
            // Marcar como edi√ß√£o para n√£o limpar os dados
            isEditingOrc = true;
            
            // Carregar itens ANTES de abrir o modal
            orcItens = o.itens.map(item => ({...item}));
            
            // Abrir modal
            await openModal('modal-orcamento');
            
            // Preencher dados no modal de edi√ß√£o DEPOIS de abrir
            document.getElementById('orc-id').value = o.id;
            document.getElementById('orc-titulo').value = o.titulo;
            document.getElementById('orc-cliente').value = o.clienteId;
            document.getElementById('orc-cliente-search').value = cliente?.nome || '';
            document.getElementById('orc-pagamento').value = o.pagamento || '';
            document.getElementById('orc-obs').value = o.obs || '';
            document.getElementById('modal-orc-title').textContent = 'Editar Or√ßamento #' + o.id;
            
            // Renderizar itens
            renderOrcItens();
        }

        async function saveOrcamento() {
            const orcId = document.getElementById('orc-id').value;
            const cliId = document.getElementById('orc-cliente').value;
            const titulo = document.getElementById('orc-titulo').value || 'Or√ßamento';
            const pagamento = document.getElementById('orc-pagamento').value;
            const obs = document.getElementById('orc-obs').value;
            
            console.log('Salvando or√ßamento:', { orcId, cliId, titulo, itens: orcItens });
            
            if (!cliId) { 
                toast('Selecione um cliente'); 
                console.error('Cliente n√£o selecionado');
                return; 
            }
            if (!orcItens.length) { 
                toast('Adicione servi√ßos'); 
                console.error('Nenhum item adicionado');
                return; 
            }
            
            try {
                const total = orcItens.reduce((s, x) => s + x.total, 0);
                const pArr = await db.perfil.toArray();
                const val = pArr[0]?.val || 15;
                
                if (orcId) {
                    // Editar existente
                    await db.orcamentos.update(parseInt(orcId), {
                        clienteId: parseInt(cliId),
                        titulo,
                        itens: orcItens,
                        total,
                        pagamento,
                        obs
                    });
                    console.log('Or√ßamento atualizado:', orcId);
                    toast('Or√ßamento atualizado!');
                } else {
                    // Criar novo
                    const novoOrc = {
                        clienteId: parseInt(cliId),
                        titulo,
                        itens: orcItens,
                        total,
                        status: 'pendente',
                        data: new Date().toISOString(),
                        val,
                        pagamento,
                        obs
                    };
                    
                    console.log('Objeto a salvar:', novoOrc);
                    
                    const id = await db.orcamentos.add(novoOrc);
                    console.log('Or√ßamento salvo com ID:', id);
                    toast('Or√ßamento criado!');
                }
                
                closeModal('modal-orcamento');
                orcItens = [];
                loadDashboard();
                loadOrcamentos();
            } catch (err) {
                console.error('Erro ao salvar:', err);
                toast('Erro ao salvar or√ßamento!');
            }
        }

        async function loadOrcamentos() {
            let o = await db.orcamentos.toArray();
            const c = document.getElementById('orcamentos-list');
            
            if (!o.length) {
                c.innerHTML = '<div class="empty-state"><p>Nenhum or√ßamento</p><button class="btn btn-primary" style="max-width:180px;margin:0 auto;" onclick="openModal(\'modal-orcamento\')">Criar</button></div>';
                document.getElementById('filters-summary').classList.remove('show');
                return;
            }
            
            // Guardar todos para filtros
            window.allOrcamentos = o;
            
            const cli = await db.clientes.toArray();
            window.allClientesMap = {}; 
            cli.forEach(x => window.allClientesMap[x.id] = x.nome);
            
            applyOrcFilters();
        }

        function applyOrcFilters() {
            const search = document.getElementById('search-orc').value.toLowerCase();
            const statusFilter = document.getElementById('filter-status').value;
            const periodoFilter = document.getElementById('filter-periodo').value;
            
            let filtered = window.allOrcamentos || [];
            
            // Filtro por status
            if (statusFilter) {
                filtered = filtered.filter(x => x.status === statusFilter);
            }
            
            // Filtro por per√≠odo
            if (periodoFilter) {
                const dias = parseInt(periodoFilter);
                const dataLimite = new Date();
                dataLimite.setDate(dataLimite.getDate() - dias);
                filtered = filtered.filter(x => new Date(x.data) >= dataLimite);
            }
            
            // Filtro por busca texto
            if (search) {
                filtered = filtered.filter(x => {
                    const clienteNome = window.allClientesMap[x.clienteId] || '';
                    return x.titulo.toLowerCase().includes(search) ||
                           clienteNome.toLowerCase().includes(search) ||
                           x.status.includes(search);
                });
            }
            
            renderOrcamentosList(filtered);
            
            // Resumo dos filtros
            const summary = document.getElementById('filters-summary');
            const totalValor = filtered.reduce((s, x) => s + x.total, 0);
            if (statusFilter || periodoFilter || search) {
                summary.innerHTML = `<strong>${filtered.length}</strong> or√ßamento(s) encontrado(s) ‚Ä¢ Total: <strong>R$ ${totalValor.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</strong>`;
                summary.classList.add('show');
            } else {
                summary.classList.remove('show');
            }
        }

        function renderOrcamentosList(orcamentos) {
            const c = document.getElementById('orcamentos-list');
            const map = window.allClientesMap || {};
            const badges = { 
                pendente: '<span class="badge badge-pending">üü° Pendente</span>', 
                fechado: '<span class="badge badge-approved">‚úÖ Fechado</span>', 
                recusado: '<span class="badge badge-rejected">‚ùå Recusado</span>' 
            };
            
            if (!orcamentos.length) {
                c.innerHTML = '<div class="empty-state" style="padding:20px;"><p>Nenhum or√ßamento encontrado com esses filtros</p></div>';
                return;
            }
            
            c.innerHTML = orcamentos.reverse().map(x => `
                <div class="list-item" onclick="viewOrc(${x.id})">
                    <div class="list-icon"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline></svg></div>
                    <div class="list-info">
                        <div class="list-title">${x.titulo}</div>
                        <div class="list-sub">${map[x.clienteId] || ''} ‚Ä¢ ${new Date(x.data).toLocaleDateString('pt-BR')}</div>
                        ${badges[x.status]}
                    </div>
                    <div class="list-value">R$ ${numberToMoeda(x.total)}</div>
                </div>
            `).join('');
        }

        async function viewOrc(id) {
            currentOrcId = id;
            const o = await db.orcamentos.get(id);
            const cli = await db.clientes.get(o.clienteId);
            const badges = { pendente: '<span class="badge badge-pending">üü° Pendente</span>', fechado: '<span class="badge badge-approved">‚úÖ Fechado</span>', recusado: '<span class="badge badge-rejected">‚ùå Recusado</span>' };
            
            // Agrupar itens por ambiente
            const ambientes = {};
            o.itens.forEach(item => {
                const amb = item.ambiente || 'Geral';
                if (!ambientes[amb]) ambientes[amb] = [];
                ambientes[amb].push(item);
            });
            
            let itensHtml = '';
            for (const [ambiente, itens] of Object.entries(ambientes)) {
                itensHtml += `<div class="orc-item-ambiente">üìç ${ambiente}</div>`;
                itensHtml += itens.map(x => `
                    <div class="orc-item">
                        <div class="orc-item-info">
                            <div class="orc-item-name">${x.nome}</div>
                            <div class="orc-item-det">${numberToMoeda(x.qtd)} ${x.un} √ó R$ ${numberToMoeda(x.preco)}</div>
                        </div>
                        <div class="orc-item-val">R$ ${numberToMoeda(x.total)}</div>
                    </div>
                `).join('');
            }
            
            let pagamentoHtml = o.pagamento ? `<div class="card" style="background:var(--cinza-bg);margin-bottom:14px;"><strong>üí≥ Pagamento:</strong> ${o.pagamento}</div>` : '';
            let obsHtml = o.obs ? `<div class="card" style="background:var(--cinza-bg);margin-bottom:14px;font-size:12px;"><strong>üìù Observa√ß√µes:</strong><br>${o.obs.replace(/\n/g, '<br>')}</div>` : '';
            
            document.getElementById('det-content').innerHTML = `
                <div style="margin-bottom:14px;"><h3 style="margin-bottom:4px;">${o.titulo}</h3>${badges[o.status]}</div>
                <div class="card" style="background:var(--cinza-bg);margin-bottom:14px;">
                    <strong>Cliente:</strong> ${cli?.nome || 'N/A'}<br>
                    <strong>Tel:</strong> ${cli?.tel || 'N/A'}<br>
                    <strong>End:</strong> ${cli?.end || 'N/A'}
                </div>
                <div class="card-title">Itens</div>
                ${itensHtml}
                <div class="orc-total"><div class="orc-total-label">Total</div><div class="orc-total-value">R$ ${numberToMoeda(o.total)}</div></div>
                ${pagamentoHtml}
                ${obsHtml}
                <p style="font-size:11px;color:var(--cinza-texto);margin-top:12px;text-align:center;">Criado em ${new Date(o.data).toLocaleDateString('pt-BR')} ‚Ä¢ V√°lido por ${o.val} dias</p>
            `;
            openModal('modal-det');
        }

        async function setStatus(s) {
            await db.orcamentos.update(currentOrcId, { status: s });
            toast('Status atualizado!');
            closeModal('modal-det');
            loadOrcamentos();
            loadDashboard();
        }

        // DASHBOARD
        let currentFilter = 'todos';

        async function loadDashboard() {
            const o = await db.orcamentos.toArray();
            const total = o.length;
            const fechados = o.filter(x => x.status === 'fechado');
            const pendentes = o.filter(x => x.status === 'pendente').length;
            const recusados = o.filter(x => x.status === 'recusado').length;
            const valorFechado = fechados.reduce((s, x) => s + x.total, 0);
            
            document.getElementById('stat-total').textContent = total;
            document.getElementById('stat-fechados').textContent = fechados.length;
            document.getElementById('stat-pendentes').textContent = pendentes;
            document.getElementById('stat-recusados').textContent = recusados;
            document.getElementById('stat-valor').textContent = `R$ ${valorFechado.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}`;
            
            loadUltimos();
        }

        function filterOrcamentos(status) {
            currentFilter = status;
            showPage('orcamentos');
            
            // Aplica o filtro ap√≥s carregar a p√°gina
            setTimeout(() => {
                const statusSelect = document.getElementById('filter-status');
                const searchInput = document.getElementById('search-orc');
                const periodoSelect = document.getElementById('filter-periodo');
                
                // Limpa outros filtros
                searchInput.value = '';
                periodoSelect.value = '';
                
                // Define o status
                if (status === 'todos') {
                    statusSelect.value = '';
                } else {
                    statusSelect.value = status;
                }
                
                applyOrcFilters();
            }, 100);
        }

        async function loadUltimos() {
            const o = await db.orcamentos.where('status').equals('pendente').reverse().toArray();
            const c = document.getElementById('ultimos-orc');
            if (!o.length) { 
                c.innerHTML = '<div class="empty-state" style="padding:20px;"><p>Nenhum or√ßamento pendente üéâ</p></div>'; 
                return; 
            }
            const cli = await db.clientes.toArray();
            const map = {}; cli.forEach(x => map[x.id] = x.nome);
            c.innerHTML = o.slice(0, 5).map(x => `
                <div class="list-item" onclick="viewOrc(${x.id})">
                    <div class="list-icon" style="background:rgba(247,192,38,0.2);"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--amarelo)" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg></div>
                    <div class="list-info">
                        <div class="list-title">${x.titulo}</div>
                        <div class="list-sub">${map[x.clienteId] || ''} ‚Ä¢ ${new Date(x.data).toLocaleDateString('pt-BR')}</div>
                    </div>
                    <div class="list-value">R$ ${numberToMoeda(x.total)}</div>
                </div>
            `).join('');
        }

        function filterList(type) {
            const search = document.getElementById('search-' + (type === 'servicos' ? 'serv' : type === 'clientes' ? 'cli' : 'orc')).value.toLowerCase();
            document.querySelectorAll(`#${type}-list .list-item`).forEach(x => {
                x.style.display = x.textContent.toLowerCase().includes(search) ? 'flex' : 'none';
            });
        }

        // PDF
        async function exportPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const o = await db.orcamentos.get(currentOrcId);
            const cli = await db.clientes.get(o.clienteId);
            const pArr = await db.perfil.toArray();
            const p = pArr[0] || {};
            
            // Cabe√ßalho
            doc.setFillColor(26, 59, 90);
            doc.rect(0, 0, 210, 40, 'F');
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(22);
            doc.setFont('helvetica', 'bold');
            doc.text('PS', 20, 22);
            doc.setFontSize(10);
            doc.text('PRO', 33, 22);
            doc.setFontSize(11);
            doc.text(p.nome || 'Minha Empresa', 60, 16);
            doc.setFontSize(9);
            doc.setFont('helvetica', 'normal');
            doc.text(p.tel || '', 60, 23);
            doc.text(p.email || '', 60, 29);
            doc.text((p.end || '').substring(0, 60), 60, 35);
            
            // T√≠tulo e dados do or√ßamento
            doc.setTextColor(26, 59, 90);
            doc.setFontSize(16);
            doc.setFont('helvetica', 'bold');
            doc.text('ORCAMENTO', 20, 55);
            doc.setFontSize(9);
            doc.setFont('helvetica', 'normal');
            doc.setTextColor(100, 100, 100);
            doc.text('No: ' + o.id.toString().padStart(4, '0'), 160, 50);
            doc.text('Data: ' + new Date(o.data).toLocaleDateString('pt-BR'), 160, 56);
            doc.text('Validade: ' + o.val + ' dias', 160, 62);
            
            // Box Cliente
            doc.setFillColor(245, 247, 250);
            doc.roundedRect(20, 68, 170, 28, 2, 2, 'F');
            doc.setTextColor(26, 59, 90);
            doc.setFontSize(10);
            doc.setFont('helvetica', 'bold');
            doc.text('CLIENTE', 25, 77);
            doc.setFont('helvetica', 'normal');
            doc.setTextColor(60, 60, 60);
            doc.text(cli?.nome || 'N/A', 25, 84);
            const cliInfo = 'Tel: ' + (cli?.tel || 'N/A') + ' | End: ' + (cli?.end || 'N/A');
            doc.text(cliInfo.substring(0, 85), 25, 91);
            
            // Agrupar itens por ambiente
            const ambientes = {};
            o.itens.forEach(item => {
                const amb = item.ambiente || 'Geral';
                if (!ambientes[amb]) ambientes[amb] = [];
                ambientes[amb].push(item);
            });
            
            let y = 108;
            
            // Posi√ß√µes das colunas (alinhadas)
            const colServico = 22;
            const colQtd = 120;
            const colUnit = 145;
            const colTotal = 172;
            
            for (const [ambiente, itens] of Object.entries(ambientes)) {
                // Verificar se precisa nova p√°gina
                if (y > 250) {
                    doc.addPage();
                    y = 20;
                }
                
                // T√≠tulo do ambiente (sem emoji)
                doc.setFillColor(26, 59, 90);
                doc.rect(20, y, 170, 8, 'F');
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(9);
                doc.setFont('helvetica', 'bold');
                doc.text('LOCAL: ' + ambiente.toUpperCase(), 25, y + 5.5);
                y += 10;
                
                // Cabe√ßalho da tabela
                doc.setFillColor(230, 235, 240);
                doc.rect(20, y, 170, 7, 'F');
                doc.setTextColor(26, 59, 90);
                doc.setFontSize(8);
                doc.setFont('helvetica', 'bold');
                doc.text('SERVICO', colServico, y + 5);
                doc.text('QTD', colQtd, y + 5);
                doc.text('UNIT.', colUnit, y + 5);
                doc.text('TOTAL', colTotal, y + 5);
                y += 9;
                
                // Itens
                doc.setFont('helvetica', 'normal');
                doc.setTextColor(60, 60, 60);
                doc.setFontSize(8);
                
                itens.forEach((x, i) => {
                    if (y > 260) {
                        doc.addPage();
                        y = 20;
                    }
                    
                    // Fundo alternado
                    if (i % 2 === 0) { 
                        doc.setFillColor(250, 250, 250); 
                        doc.rect(20, y - 4, 170, 7, 'F'); 
                    }
                    
                    // Dados
                    doc.setTextColor(60, 60, 60);
                    doc.text(x.nome.substring(0, 45), colServico, y);
                    doc.text(numberToMoeda(x.qtd) + ' ' + x.un, colQtd, y);
                    doc.text('R$ ' + numberToMoeda(x.preco), colUnit, y);
                    doc.text('R$ ' + numberToMoeda(x.total), colTotal, y);
                    y += 7;
                });
                
                y += 5;
            }
            
            // Total
            y += 2;
            doc.setFillColor(247, 192, 38);
            doc.roundedRect(120, y, 70, 12, 2, 2, 'F');
            doc.setTextColor(26, 59, 90);
            doc.setFontSize(11);
            doc.setFont('helvetica', 'bold');
            doc.text('TOTAL: R$ ' + numberToMoeda(o.total), 125, y + 8);
            
            y += 20;
            
            // Forma de Pagamento
            if (o.pagamento) {
                if (y > 250) { doc.addPage(); y = 20; }
                doc.setFillColor(245, 247, 250);
                doc.roundedRect(20, y, 170, 12, 2, 2, 'F');
                doc.setTextColor(26, 59, 90);
                doc.setFontSize(9);
                doc.setFont('helvetica', 'bold');
                doc.text('FORMA DE PAGAMENTO:', 25, y + 8);
                doc.setFont('helvetica', 'normal');
                doc.setTextColor(60, 60, 60);
                doc.text(o.pagamento.substring(0, 55), 78, y + 8);
                y += 18;
            }
            
            // Observa√ß√µes
            if (o.obs) {
                if (y > 230) { doc.addPage(); y = 20; }
                
                doc.setFillColor(245, 247, 250);
                doc.roundedRect(20, y, 170, 8, 2, 2, 'F');
                doc.setTextColor(26, 59, 90);
                doc.setFontSize(9);
                doc.setFont('helvetica', 'bold');
                doc.text('OBSERVACOES:', 25, y + 5.5);
                y += 12;
                
                doc.setFont('helvetica', 'normal');
                doc.setTextColor(60, 60, 60);
                doc.setFontSize(8);
                
                // Quebrar observa√ß√µes em linhas
                const obsLines = doc.splitTextToSize(o.obs, 165);
                obsLines.forEach(line => {
                    if (y > 275) { doc.addPage(); y = 20; }
                    doc.text(line, 25, y);
                    y += 5;
                });
            }
            
            // Rodap√©
            doc.setTextColor(150, 150, 150);
            doc.setFontSize(7);
            doc.setFont('helvetica', 'normal');
            doc.text('Orcamento gerado pelo PS Pro - Painel Services', 20, 285);
            
            doc.save('orcamento_' + o.id + '_' + (cli?.nome?.replace(/\s/g, '_') || 'cliente') + '.pdf');
            toast('PDF exportado!');
        }

        // M√ÅSCARAS
        function maskCPFCNPJ(v) {
            v = v.replace(/\D/g, '');
            if (v.length <= 11) {
                v = v.replace(/(\d{3})(\d)/, '$1.$2');
                v = v.replace(/(\d{3})(\d)/, '$1.$2');
                v = v.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
            } else {
                v = v.substring(0, 14);
                v = v.replace(/^(\d{2})(\d)/, '$1.$2');
                v = v.replace(/^(\d{2})\.(\d{3})(\d)/, '$1.$2.$3');
                v = v.replace(/\.(\d{3})(\d)/, '.$1/$2');
                v = v.replace(/(\d{4})(\d)/, '$1-$2');
            }
            return v;
        }

        function maskTel(v) {
            v = v.replace(/\D/g, '');
            v = v.substring(0, 11);
            if (v.length > 10) {
                v = v.replace(/^(\d{2})(\d{5})(\d{4}).*/, '($1) $2-$3');
            } else if (v.length > 6) {
                v = v.replace(/^(\d{2})(\d{4})(\d{0,4}).*/, '($1) $2-$3');
            } else if (v.length > 2) {
                v = v.replace(/^(\d{2})(\d{0,5})/, '($1) $2');
            } else if (v.length > 0) {
                v = v.replace(/^(\d*)/, '($1');
            }
            return v;
        }

        // Aplicar m√°scaras - Perfil
        document.getElementById('perfil-doc').addEventListener('input', function(e) {
            e.target.value = maskCPFCNPJ(e.target.value);
        });
        document.getElementById('perfil-tel').addEventListener('input', function(e) {
            e.target.value = maskTel(e.target.value);
        });
        document.getElementById('perfil-cep').addEventListener('input', function(e) {
            e.target.value = maskCEP(e.target.value);
        });

        // Busca CEP para Perfil
        async function buscarCEPPerfil(cep) {
            cep = cep.replace(/\D/g, '');
            if (cep.length !== 8) return;
            
            toast('Buscando CEP...');
            
            try {
                const resp = await fetch(`https://viacep.com.br/ws/${cep}/json/`, {
                    method: 'GET',
                    mode: 'cors'
                });
                
                if (!resp.ok) {
                    toast('Erro na busca do CEP');
                    return;
                }
                
                const data = await resp.json();
                
                if (data.erro) {
                    toast('CEP n√£o encontrado');
                    return;
                }
                
                const partes = [];
                if (data.logradouro) partes.push(data.logradouro);
                if (data.bairro) partes.push(data.bairro);
                if (data.localidade) partes.push(data.localidade + (data.uf ? ' - ' + data.uf : ''));
                
                const endereco = partes.join(', ');
                document.getElementById('perfil-end').value = endereco;
                document.getElementById('perfil-num').focus();
                toast('Endere√ßo encontrado!');
            } catch (err) {
                console.error('Erro CEP:', err);
                toast('Erro ao buscar CEP. Verifique sua conex√£o.');
            }
        }

        // Aplicar m√°scaras - Cliente
        document.getElementById('cliente-doc').addEventListener('input', function(e) {
            e.target.value = maskCPFCNPJ(e.target.value);
        });
        document.getElementById('cliente-tel').addEventListener('input', function(e) {
            e.target.value = maskTel(e.target.value);
        });
        document.getElementById('cliente-cep').addEventListener('input', function(e) {
            e.target.value = maskCEP(e.target.value);
        });

        // M√°scara CEP
        function maskCEP(v) {
            v = v.replace(/\D/g, '');
            v = v.substring(0, 8);
            v = v.replace(/^(\d{5})(\d)/, '$1-$2');
            return v;
        }

        // M√°scara Moeda Brasileira (1.234,56)
        function maskMoeda(v) {
            v = v.replace(/\D/g, '');
            if (v === '') return '';
            v = (parseInt(v) / 100).toFixed(2);
            v = v.replace('.', ',');
            v = v.replace(/\B(?=(\d{3})+(?!\d))/g, '.');
            return v;
        }

        // Converter moeda formatada para n√∫mero
        function moedaToNumber(v) {
            if (!v) return 0;
            return parseFloat(v.replace(/\./g, '').replace(',', '.')) || 0;
        }

        // Formatar n√∫mero para moeda
        function numberToMoeda(n) {
            if (!n && n !== 0) return '';
            return n.toFixed(2).replace('.', ',').replace(/\B(?=(\d{3})+(?!\d))/g, '.');
        }

        // Busca CEP via ViaCEP
        async function buscarCEP(cep) {
            cep = cep.replace(/\D/g, '');
            if (cep.length !== 8) return;
            
            toast('Buscando CEP...');
            
            try {
                const resp = await fetch(`https://viacep.com.br/ws/${cep}/json/`, {
                    method: 'GET',
                    mode: 'cors'
                });
                
                if (!resp.ok) {
                    toast('Erro na busca do CEP');
                    return;
                }
                
                const data = await resp.json();
                
                if (data.erro) {
                    toast('CEP n√£o encontrado');
                    return;
                }
                
                const partes = [];
                if (data.logradouro) partes.push(data.logradouro);
                if (data.bairro) partes.push(data.bairro);
                if (data.localidade) partes.push(data.localidade + (data.uf ? ' - ' + data.uf : ''));
                
                const endereco = partes.join(', ');
                document.getElementById('cliente-end').value = endereco;
                document.getElementById('cliente-num').focus();
                toast('Endere√ßo encontrado!');
            } catch (err) {
                console.error('Erro CEP:', err);
                toast('Erro ao buscar CEP. Verifique sua conex√£o.');
            }
        }

        // DADOS INICIAIS
        async function seedDatabase() {
            const servicosCount = await db.servicos.count();
            if (servicosCount > 0) return; // J√° tem dados

            // SERVI√áOS - Tabela de Pintura 2025
            const servicos = [
                // DI√ÅRIAS
                { nome: 'Di√°ria Ajudante', un: 'di√°ria', preco: 116.35, desc: 'Servi√ßo b√°sico - 8hs' },
                { nome: 'Di√°ria Profissional', un: 'di√°ria', preco: 202.08, desc: 'Servi√ßos gerais de pintura - 8hs' },
                { nome: 'Di√°ria L√≠der', un: 'di√°ria', preco: 232.70, desc: 'Pintor Profissional L√≠der - 8hs' },
                { nome: 'Di√°ria Cordeiro Ajudante', un: 'di√°ria', preco: 220.45, desc: 'Pintor Ajudante Cordeiro/Cadeirinha - 8hs' },
                { nome: 'Di√°ria Cordeiro Profissional', un: 'di√°ria', preco: 281.69, desc: 'Pintor Profissional Cordeiro/Cadeirinha - 8hs' },
                { nome: 'Di√°ria Propriet√°rio', un: 'di√°ria', preco: 330.67, desc: 'Com ferramentas, equipamentos e certificados' },
                
                // LAVAGEM
                { nome: 'Lavagem Tijolinho', un: 'm¬≤', preco: 5.16, desc: 'Para aplica√ß√£o de silicone - at√© 3m altura' },
                { nome: 'Lavagem Calha Simples', un: 'm', preco: 13.78, desc: 'Telhado simples - at√© 3m altura' },
                { nome: 'Lavagem Calha Sobrado', un: 'm', preco: 21.77, desc: 'Acima 3 metros' },
                { nome: 'Lavagem Pingadeiras', un: 'm', preco: 9.53, desc: 'Para muros' },
                { nome: 'Lavagem Caixa D√°gua Baixa', un: 'un', preco: 217.61, desc: 'Telhado baixo - at√© 3m' },
                { nome: 'Lavagem Caixa D√°gua Alta', un: 'un', preco: 326.37, desc: 'Telhado alto - acima 3m' },
                { nome: 'Lavagem Telhado Baixo', un: 'm¬≤', preco: 13.61, desc: 'Lavadora pressurizada - at√© 3m' },
                { nome: 'Lavagem Telhado Alto', un: 'm¬≤', preco: 17.63, desc: 'Lavadora pressurizada - acima 3m' },
                { nome: 'Lavagem Parede at√© 3m', un: 'm¬≤', preco: 4.54, desc: 'Sujeiras em geral' },
                { nome: 'Lavagem Parede acima 3m', un: 'm¬≤', preco: 11.51, desc: 'Sujeiras em geral' },
                { nome: 'Lavagem Piso Mangueira', un: 'm¬≤', preco: 5.20, desc: 'Lavagem simples' },
                { nome: 'Lavagem Piso Pressurizada', un: 'm¬≤', preco: 8.56, desc: '√Ågua pressurizada' },
                
                // TELHAS
                { nome: 'Resina Telhas 2 dem√£os', un: 'm¬≤', preco: 23.47, desc: 'Lavagem incluso' },
                { nome: 'Resina Telhas 3 dem√£os', un: 'm¬≤', preco: 29.99, desc: 'Lavagem incluso' },
                { nome: 'Resina Telhas Fibrocimento', un: 'm¬≤', preco: 35.38, desc: 'Fibrocimento ou Amianto' },
                
                // CALHAS PINTURA
                { nome: 'Pintura Calha Simples', un: 'm', preco: 30.50, desc: 'Telhado simples - at√© 3m' },
                { nome: 'Pintura Calha Sobrado', un: 'm', preco: 38.10, desc: 'Acima 3 metros' },
                { nome: 'Pintura Pingadeiras', un: 'm', preco: 18.43, desc: 'Para muros' },
                
                // EP√ìXI
                { nome: 'Ep√≥xi Industrial', un: 'm¬≤', preco: 285.48, desc: 'Alta espessura - Fundo + Acabamento' },
                { nome: 'Ep√≥xi 3D Art√≠stico', un: 'm¬≤', preco: 407.84, desc: 'Fundo + Acab + Adesivo' },
                
                // REPAROS
                { nome: 'Acerto Cimento Parede', un: 'm¬≤', preco: 18.37, desc: 'Grandes corre√ß√µes - at√© 3m' },
                { nome: 'Fissuras Selante', un: 'm', preco: 11.45, desc: 'Selante para trincas' },
                { nome: 'Trincas Tela e Massa', un: 'm', preco: 22.45, desc: 'Tela e massa' },
                
                // PAPEL PAREDE
                { nome: 'Papel Parede Comum at√© 3m', un: 'un', preco: 91.74, desc: 'Por rolo' },
                { nome: 'Papel Parede Comum acima 3m', un: 'un', preco: 139.37, desc: 'Por rolo' },
                { nome: 'Papel Parede Importado at√© 3m', un: 'un', preco: 125.70, desc: 'Por rolo' },
                
                // PINTURA PAREDE - L√ÅTEX PVA
                { nome: 'Repintura L√°tex PVA 2 dem√£os', un: 'm¬≤', preco: 8.50, desc: 'Apenas repintura' },
                { nome: 'Selador + 2 L√°tex PVA', un: 'm¬≤', preco: 12.80, desc: '1 selador + 2 dem√£os tinta' },
                { nome: 'Selador + 3 L√°tex PVA', un: 'm¬≤', preco: 14.50, desc: '1 selador + 3 dem√£os tinta' },
                { nome: 'Selador + Massa PVA + 2 L√°tex', un: 'm¬≤', preco: 22.50, desc: 'Selador + 2 massa + 2 tinta' },
                { nome: 'Selador + Massa PVA + 3 L√°tex', un: 'm¬≤', preco: 25.80, desc: 'Selador + 2 massa + 3 tinta' },
                
                // PINTURA PAREDE - ACR√çLICA
                { nome: 'Repintura Acr√≠lica Fosca 2 dem√£os', un: 'm¬≤', preco: 10.20, desc: 'Apenas repintura' },
                { nome: 'Selador + 2 Acr√≠lica Fosca', un: 'm¬≤', preco: 15.30, desc: '1 selador + 2 dem√£os' },
                { nome: 'Selador + 3 Acr√≠lica Fosca', un: 'm¬≤', preco: 17.80, desc: '1 selador + 3 dem√£os' },
                { nome: 'Selador + Massa Acr√≠lica + 2 Acr√≠lica', un: 'm¬≤', preco: 28.50, desc: 'Selador + 2 massa + 2 tinta' },
                { nome: 'Selador + Massa Acr√≠lica + 3 Acr√≠lica', un: 'm¬≤', preco: 32.80, desc: 'Selador + 2 massa + 3 tinta' },
                { nome: 'Selador + 3 Massa + 2 Acr√≠lica Acetinado', un: 'm¬≤', preco: 48.28, desc: 'Premium acetinado' },
                { nome: 'Selador + 3 Massa + 3 Acr√≠lica Acetinado', un: 'm¬≤', preco: 51.11, desc: 'Premium acetinado' },
                { nome: 'Selador + 2 Massa + 2 Acr√≠lica Semi-Brilho', un: 'm¬≤', preco: 49.90, desc: 'Premium semi-brilho' },
                { nome: 'Selador + 3 Massa + 3 Acr√≠lica Semi-Brilho', un: 'm¬≤', preco: 54.86, desc: 'Premium semi-brilho' },
                
                // DRYWALL
                { nome: 'Repintura Drywall', un: 'm¬≤', preco: 14.29, desc: 'Drywall j√° pintado' },
                { nome: 'Drywall Fundo + 2 Fosco', un: 'm¬≤', preco: 23.13, desc: 'Lixar + Fundo + 2 dem√£os fosco' },
                { nome: 'Drywall Massa Emendas + 2 Fosco', un: 'm¬≤', preco: 29.20, desc: 'Fundo + Massa emendas + 2 fosco' },
                { nome: 'Drywall Massa Geral + 2 Fosco', un: 'm¬≤', preco: 39.46, desc: 'Fundo + Massa geral + 2 fosco' },
                { nome: 'Drywall Massa Emendas + 2 Acetinado', un: 'm¬≤', preco: 34.64, desc: 'Fundo + Massa emendas + 2 acetinado' },
                { nome: 'Drywall Massa Geral + 2 Acetinado', un: 'm¬≤', preco: 44.85, desc: 'Fundo + Massa geral + 2 acetinado' },
                { nome: 'Drywall Massa Emendas + 2 Semi-Brilho', un: 'm¬≤', preco: 45.47, desc: 'Fundo + Massa emendas + 2 semi-brilho' },
                { nome: 'Drywall Massa Geral + 2 Semi-Brilho', un: 'm¬≤', preco: 44.91, desc: 'Fundo + Massa geral + 2 semi-brilho' },
                
                // EXTERNOS
                { nome: 'Pintura Muro Externo', un: 'm¬≤', preco: 16.50, desc: '2 dem√£os acr√≠lica externa' },
                { nome: 'Pintura Fachada at√© 3m', un: 'm¬≤', preco: 18.80, desc: 'Acr√≠lica externa' },
                { nome: 'Pintura Fachada acima 3m', un: 'm¬≤', preco: 24.50, desc: 'Acr√≠lica externa com andaime' },
                { nome: 'Textura R√∫stica', un: 'm¬≤', preco: 28.00, desc: 'Textura grafiato/r√∫stica' },
                { nome: 'Textura Lisa', un: 'm¬≤', preco: 22.50, desc: 'Textura lisa rolada' },
                
                // PORTAS E JANELAS
                { nome: 'Pintura Porta Lisa', un: 'un', preco: 85.00, desc: 'Porta lisa dos dois lados' },
                { nome: 'Pintura Porta Frisada', un: 'un', preco: 120.00, desc: 'Porta frisada dos dois lados' },
                { nome: 'Pintura Janela Madeira P', un: 'un', preco: 95.00, desc: 'Janela pequena' },
                { nome: 'Pintura Janela Madeira M', un: 'un', preco: 145.00, desc: 'Janela m√©dia' },
                { nome: 'Pintura Janela Madeira G', un: 'un', preco: 195.00, desc: 'Janela grande' },
                { nome: 'Pintura Grade/Port√£o P', un: 'un', preco: 150.00, desc: 'Grade ou port√£o pequeno' },
                { nome: 'Pintura Grade/Port√£o M', un: 'un', preco: 280.00, desc: 'Grade ou port√£o m√©dio' },
                { nome: 'Pintura Grade/Port√£o G', un: 'un', preco: 450.00, desc: 'Grade ou port√£o grande' },
                
                // TETO
                { nome: 'Pintura Teto Repintura', un: 'm¬≤', preco: 12.50, desc: 'Apenas repintura' },
                { nome: 'Pintura Teto Selador + 2 dem√£os', un: 'm¬≤', preco: 18.00, desc: 'Selador + 2 dem√£os' },
                { nome: 'Pintura Teto com Massa', un: 'm¬≤', preco: 32.00, desc: 'Selador + Massa + 2 dem√£os' },
                
                // DESLOCAMENTO
                { nome: 'Deslocamento por KM', un: 'un', preco: 8.11, desc: 'Por quil√¥metro rodado' }
            ];

            await db.servicos.bulkAdd(servicos);

            // CLIENTES
            const clientes = [
                { nome: 'Jo√£o Silva Santos', doc: '123.456.789-00', tel: '(11) 99876-5432', email: 'joao.silva@email.com', end: 'Rua das Flores, 123 - Vila Nova, S√£o Paulo - SP', obs: 'Cliente antigo, sempre paga em dia' },
                { nome: 'Maria Oliveira Costa', doc: '234.567.890-11', tel: '(11) 98765-4321', email: 'maria.oliveira@email.com', end: 'Av. Brasil, 456 - Centro, S√£o Paulo - SP', obs: 'Prefere pagamento parcelado' },
                { nome: 'Carlos Eduardo Ferreira', doc: '345.678.901-22', tel: '(11) 97654-3210', email: 'carlos.ferreira@email.com', end: 'Rua dos Pinheiros, 789 - Pinheiros, S√£o Paulo - SP', obs: '' },
                { nome: 'Ana Paula Rodrigues', doc: '456.789.012-33', tel: '(11) 96543-2109', email: 'ana.rodrigues@email.com', end: 'Rua Augusta, 321 - Consola√ß√£o, S√£o Paulo - SP', obs: 'Indica√ß√£o do Jo√£o Silva' },
                { nome: 'Pedro Henrique Almeida', doc: '567.890.123-44', tel: '(11) 95432-1098', email: 'pedro.almeida@email.com', end: 'Av. Paulista, 1000 - Bela Vista, S√£o Paulo - SP', obs: 'Apartamento de alto padr√£o' },
                { nome: 'Fernanda Lima Souza', doc: '678.901.234-55', tel: '(11) 94321-0987', email: 'fernanda.souza@email.com', end: 'Rua Oscar Freire, 555 - Jardins, S√£o Paulo - SP', obs: '' },
                { nome: 'Ricardo Mendes Neto', doc: '789.012.345-66', tel: '(11) 93210-9876', email: 'ricardo.mendes@email.com', end: 'Alameda Santos, 888 - Cerqueira C√©sar, S√£o Paulo - SP', obs: 'Escrit√≥rio comercial' },
                { nome: 'Juliana Martins Pereira', doc: '890.123.456-77', tel: '(11) 92109-8765', email: 'juliana.martins@email.com', end: 'Rua Haddock Lobo, 222 - Jardim Paulista, S√£o Paulo - SP', obs: '' },
                { nome: 'Marcos Ant√¥nio Ribeiro', doc: '901.234.567-88', tel: '(11) 91098-7654', email: 'marcos.ribeiro@email.com', end: 'Av. Rebou√ßas, 3333 - Pinheiros, S√£o Paulo - SP', obs: 'Pr√©dio comercial' },
                { nome: 'Patr√≠cia Gomes Cardoso', doc: '012.345.678-99', tel: '(11) 90987-6543', email: 'patricia.cardoso@email.com', end: 'Rua da Consola√ß√£o, 444 - Consola√ß√£o, S√£o Paulo - SP', obs: '' },
                { nome: 'Lucas Fernandes Silva', doc: '111.222.333-44', tel: '(11) 99111-2222', email: 'lucas.fernandes@email.com', end: 'Rua Vergueiro, 1500 - Vila Mariana, S√£o Paulo - SP', obs: 'Casa t√©rrea' },
                { nome: 'Camila Rocha Dias', doc: '222.333.444-55', tel: '(11) 98222-3333', email: 'camila.rocha@email.com', end: 'Av. Ibirapuera, 2500 - Moema, S√£o Paulo - SP', obs: '' },
                { nome: 'Bruno Costa Machado', doc: '333.444.555-66', tel: '(11) 97333-4444', email: 'bruno.costa@email.com', end: 'Rua Pamplona, 666 - Jardim Paulista, S√£o Paulo - SP', obs: 'Cobertura duplex' },
                { nome: 'Amanda Freitas Lopes', doc: '444.555.666-77', tel: '(11) 96444-5555', email: 'amanda.freitas@email.com', end: 'Alameda Ja√∫, 777 - Jardim Paulista, S√£o Paulo - SP', obs: '' },
                { nome: 'Thiago Alves Moreira', doc: '555.666.777-88', tel: '(11) 95555-6666', email: 'thiago.alves@email.com', end: 'Rua Estados Unidos, 888 - Jardim Am√©rica, S√£o Paulo - SP', obs: 'Reforma completa' },
                { nome: 'Larissa Santos Ara√∫jo', doc: '666.777.888-99', tel: '(11) 94666-7777', email: 'larissa.santos@email.com', end: 'Av. Europa, 999 - Jardim Europa, S√£o Paulo - SP', obs: '' },
                { nome: 'Felipe Barbosa Lima', doc: '777.888.999-00', tel: '(11) 93777-8888', email: 'felipe.barbosa@email.com', end: 'Rua Groenl√¢ndia, 111 - Jardim Am√©rica, S√£o Paulo - SP', obs: 'Casa de 3 andares' },
                { nome: 'Mariana Teixeira Ramos', doc: '888.999.000-11', tel: '(11) 92888-9999', email: 'mariana.teixeira@email.com', end: 'Alameda Lorena, 222 - Jardins, S√£o Paulo - SP', obs: '' },
                { nome: 'Gustavo Pereira Nunes', doc: '999.000.111-22', tel: '(11) 91999-0000', email: 'gustavo.pereira@email.com', end: 'Rua Bela Cintra, 333 - Consola√ß√£o, S√£o Paulo - SP', obs: 'Apartamento 150m¬≤' },
                { nome: 'Isabela Cunha Monteiro', doc: '000.111.222-33', tel: '(11) 90000-1111', email: 'isabela.cunha@email.com', end: 'Av. Cidade Jardim, 444 - Itaim Bibi, S√£o Paulo - SP', obs: '' },
                { nome: 'Rafael Campos Duarte', doc: '112.233.445-56', tel: '(11) 99112-2334', email: 'rafael.campos@email.com', end: 'Rua Funchal, 555 - Vila Ol√≠mpia, S√£o Paulo - SP', obs: 'Sala comercial' },
                { nome: 'Beatriz Moura Vieira', doc: '223.344.556-67', tel: '(11) 98223-3445', email: 'beatriz.moura@email.com', end: 'Av. Faria Lima, 666 - Pinheiros, S√£o Paulo - SP', obs: '' },
                { nome: 'Andr√© Luiz Correia', doc: '334.455.667-78', tel: '(11) 97334-4556', email: 'andre.correia@email.com', end: 'Rua Joaquim Floriano, 777 - Itaim Bibi, S√£o Paulo - SP', obs: 'Empresa de TI' },
                { nome: 'Carolina Pinto Azevedo', doc: '445.566.778-89', tel: '(11) 96445-5667', email: 'carolina.pinto@email.com', end: 'Alameda Gabriel Monteiro da Silva, 888 - Jardins, S√£o Paulo - SP', obs: '' },
                { nome: 'Diego Santana Reis', doc: '556.677.889-90', tel: '(11) 95556-6778', email: 'diego.santana@email.com', end: 'Rua Tabapu√£, 999 - Itaim Bibi, S√£o Paulo - SP', obs: 'Loja de roupas' },
                { nome: 'Let√≠cia Carvalho Melo', doc: '667.788.990-01', tel: '(11) 94667-7889', email: 'leticia.carvalho@email.com', end: 'Av. Brigadeiro Faria Lima, 1010 - Pinheiros, S√£o Paulo - SP', obs: '' },
                { nome: 'Vin√≠cius Ramos Castro', doc: '778.899.001-12', tel: '(11) 93778-8990', email: 'vinicius.ramos@email.com', end: 'Rua Leopoldo Couto Magalh√£es Jr, 1111 - Itaim Bibi, S√£o Paulo - SP', obs: 'Cl√≠nica m√©dica' },
                { nome: 'Nat√°lia Borges Prado', doc: '889.900.112-23', tel: '(11) 92889-9001', email: 'natalia.borges@email.com', end: 'Alameda Itu, 1212 - Jardim Paulista, S√£o Paulo - SP', obs: '' },
                { nome: 'Eduardo Fonseca Dias', doc: '990.011.223-34', tel: '(11) 91990-0112', email: 'eduardo.fonseca@email.com', end: 'Rua Peixoto Gomide, 1313 - Jardins, S√£o Paulo - SP', obs: 'Restaurante' },
                { nome: 'Vanessa Lima Nogueira', doc: '001.122.334-45', tel: '(11) 90001-1223', email: 'vanessa.lima@email.com', end: 'Av. Santo Amaro, 1414 - Vila Nova Concei√ß√£o, S√£o Paulo - SP', obs: '' },
                { nome: 'Roberto Maia Gomes', doc: '113.224.335-46', tel: '(11) 99113-2243', email: 'roberto.maia@email.com', end: 'Rua Normandia, 1515 - Vila Madalena, S√£o Paulo - SP', obs: 'Est√∫dio de m√∫sica' },
                { nome: 'Aline Vasconcelos Cruz', doc: '224.335.446-57', tel: '(11) 98224-3354', email: 'aline.vasconcelos@email.com', end: 'Rua Aspicuelta, 1616 - Vila Madalena, S√£o Paulo - SP', obs: '' },
                { nome: 'Henrique Barros Leal', doc: '335.446.557-68', tel: '(11) 97335-4465', email: 'henrique.barros@email.com', end: 'Rua Harmonia, 1717 - Vila Madalena, S√£o Paulo - SP', obs: 'Galeria de arte' },
                { nome: 'Renata Silveira Matos', doc: '446.557.668-79', tel: '(11) 96446-5576', email: 'renata.silveira@email.com', end: 'Rua Fidalga, 1818 - Vila Madalena, S√£o Paulo - SP', obs: '' },
                { nome: 'F√°bio Miranda Teles', doc: '557.668.779-80', tel: '(11) 95557-6687', email: 'fabio.miranda@email.com', end: 'Rua Mourato Coelho, 1919 - Pinheiros, S√£o Paulo - SP', obs: 'Bar e restaurante' },
                { nome: 'Priscila Andrade Faria', doc: '668.779.880-91', tel: '(11) 94668-7798', email: 'priscila.andrade@email.com', end: 'Rua dos Pinheiros, 2020 - Pinheiros, S√£o Paulo - SP', obs: '' },
                { nome: 'S√©rgio Neves Guimar√£es', doc: '779.880.991-02', tel: '(11) 93779-8809', email: 'sergio.neves@email.com', end: 'Rua Teodoro Sampaio, 2121 - Pinheiros, S√£o Paulo - SP', obs: 'Escrit√≥rio advocacia' },
                { nome: 'D√©bora Costa Amaral', doc: '880.991.002-13', tel: '(11) 92880-9910', email: 'debora.costa@email.com', end: 'Rua Cardeal Arcoverde, 2222 - Pinheiros, S√£o Paulo - SP', obs: '' },
                { nome: 'Leandro Pires Machado', doc: '991.002.113-24', tel: '(11) 91991-0021', email: 'leandro.pires@email.com', end: 'Av. Henrique Schaumann, 2323 - Pinheiros, S√£o Paulo - SP', obs: 'Academia' },
                { nome: 'Tatiane Sousa Ribeiro', doc: '002.113.224-35', tel: '(11) 90002-1132', email: 'tatiane.sousa@email.com', end: 'Rua Artur de Azevedo, 2424 - Pinheiros, S√£o Paulo - SP', obs: 'Sal√£o de beleza' }
            ];

            await db.clientes.bulkAdd(clientes);

            // OR√áAMENTOS
            const hoje = new Date();
            const orcamentos = [
                {
                    clienteId: 1,
                    titulo: 'Pintura Apartamento Completo',
                    itens: [
                        { servId: 42, nome: 'Selador + Massa Acr√≠lica + 2 Acr√≠lica', preco: 28.50, un: 'm¬≤', qtd: 180, total: 5130 },
                        { servId: 69, nome: 'Pintura Teto com Massa', preco: 32.00, un: 'm¬≤', qtd: 65, total: 2080 },
                        { servId: 61, nome: 'Pintura Porta Lisa', preco: 85.00, un: 'un', qtd: 6, total: 510 }
                    ],
                    total: 7720,
                    status: 'fechado',
                    data: new Date(hoje.getTime() - 45 * 24 * 60 * 60 * 1000).toISOString(),
                    val: 15
                },
                {
                    clienteId: 2,
                    titulo: 'Pintura Externa Casa',
                    itens: [
                        { servId: 57, nome: 'Pintura Fachada at√© 3m', preco: 18.80, un: 'm¬≤', qtd: 120, total: 2256 },
                        { servId: 56, nome: 'Pintura Muro Externo', preco: 16.50, un: 'm¬≤', qtd: 85, total: 1402.50 },
                        { servId: 66, nome: 'Pintura Grade/Port√£o M', preco: 280.00, un: 'un', qtd: 1, total: 280 }
                    ],
                    total: 3938.50,
                    status: 'fechado',
                    data: new Date(hoje.getTime() - 40 * 24 * 60 * 60 * 1000).toISOString(),
                    val: 15
                },
                {
                    clienteId: 5,
                    titulo: 'Reforma Cobertura Duplex',
                    itens: [
                        { servId: 44, nome: 'Selador + 3 Massa + 2 Acr√≠lica Acetinado', preco: 48.28, un: 'm¬≤', qtd: 320, total: 15449.60 },
                        { servId: 69, nome: 'Pintura Teto com Massa', preco: 32.00, un: 'm¬≤', qtd: 150, total: 4800 },
                        { servId: 62, nome: 'Pintura Porta Frisada', preco: 120.00, un: 'un', qtd: 12, total: 1440 },
                        { servId: 59, nome: 'Textura R√∫stica', preco: 28.00, un: 'm¬≤', qtd: 45, total: 1260 }
                    ],
                    total: 22949.60,
                    status: 'fechado',
                    data: new Date(hoje.getTime() - 35 * 24 * 60 * 60 * 1000).toISOString(),
                    val: 15
                },
                {
                    clienteId: 8,
                    titulo: 'Escrit√≥rio Comercial',
                    itens: [
                        { servId: 48, nome: 'Drywall Fundo + 2 Fosco', preco: 23.13, un: 'm¬≤', qtd: 200, total: 4626 },
                        { servId: 68, nome: 'Pintura Teto Selador + 2 dem√£os', preco: 18.00, un: 'm¬≤', qtd: 85, total: 1530 }
                    ],
                    total: 6156,
                    status: 'fechado',
                    data: new Date(hoje.getTime() - 30 * 24 * 60 * 60 * 1000).toISOString(),
                    val: 15
                },
                {
                    clienteId: 12,
                    titulo: 'Pintura Sala e Quartos',
                    itens: [
                        { servId: 40, nome: 'Selador + 2 Acr√≠lica Fosca', preco: 15.30, un: 'm¬≤', qtd: 95, total: 1453.50 },
                        { servId: 67, nome: 'Pintura Teto Repintura', preco: 12.50, un: 'm¬≤', qtd: 40, total: 500 }
                    ],
                    total: 1953.50,
                    status: 'fechado',
                    data: new Date(hoje.getTime() - 25 * 24 * 60 * 60 * 1000).toISOString(),
                    val: 15
                },
                {
                    clienteId: 15,
                    titulo: 'Reforma Completa Apartamento 200m¬≤',
                    itens: [
                        { servId: 46, nome: 'Selador + 2 Massa + 2 Acr√≠lica Semi-Brilho', preco: 49.90, un: 'm¬≤', qtd: 280, total: 13972 },
                        { servId: 69, nome: 'Pintura Teto com Massa', preco: 32.00, un: 'm¬≤', qtd: 95, total: 3040 },
                        { servId: 62, nome: 'Pintura Porta Frisada', preco: 120.00, un: 'un', qtd: 8, total: 960 },
                        { servId: 64, nome: 'Pintura Janela Madeira M', preco: 145.00, un: 'un', qtd: 5, total: 725 }
                    ],
                    total: 18697,
                    status: 'fechado',
                    data: new Date(hoje.getTime() - 20 * 24 * 60 * 60 * 1000).toISOString(),
                    val: 15
                },
                {
                    clienteId: 18,
                    titulo: 'Cl√≠nica M√©dica - Recep√ß√£o',
                    itens: [
                        { servId: 52, nome: 'Drywall Massa Geral + 2 Acetinado', preco: 44.85, un: 'm¬≤', qtd: 85, total: 3812.25 },
                        { servId: 68, nome: 'Pintura Teto Selador + 2 dem√£os', preco: 18.00, un: 'm¬≤', qtd: 45, total: 810 }
                    ],
                    total: 4622.25,
                    status: 'fechado',
                    data: new Date(hoje.getTime() - 15 * 24 * 60 * 60 * 1000).toISOString(),
                    val: 15
                },
                {
                    clienteId: 22,
                    titulo: 'Pintura Restaurante',
                    itens: [
                        { servId: 42, nome: 'Selador + Massa Acr√≠lica + 2 Acr√≠lica', preco: 28.50, un: 'm¬≤', qtd: 150, total: 4275 },
                        { servId: 69, nome: 'Pintura Teto com Massa', preco: 32.00, un: 'm¬≤', qtd: 70, total: 2240 },
                        { servId: 7, nome: 'Lavagem Tijolinho', preco: 5.16, un: 'm¬≤', qtd: 25, total: 129 }
                    ],
                    total: 6644,
                    status: 'fechado',
                    data: new Date(hoje.getTime() - 10 * 24 * 60 * 60 * 1000).toISOString(),
                    val: 15
                },
                {
                    clienteId: 25,
                    titulo: 'Loja de Roupas - Shopping',
                    itens: [
                        { servId: 48, nome: 'Drywall Fundo + 2 Fosco', preco: 23.13, un: 'm¬≤', qtd: 120, total: 2775.60 },
                        { servId: 61, nome: 'Pintura Porta Lisa', preco: 85.00, un: 'un', qtd: 2, total: 170 }
                    ],
                    total: 2945.60,
                    status: 'pendente',
                    data: new Date(hoje.getTime() - 7 * 24 * 60 * 60 * 1000).toISOString(),
                    val: 15
                },
                {
                    clienteId: 28,
                    titulo: 'Apartamento Pequeno 60m¬≤',
                    itens: [
                        { servId: 36, nome: 'Selador + Massa PVA + 2 L√°tex', preco: 22.50, un: 'm¬≤', qtd: 85, total: 1912.50 },
                        { servId: 67, nome: 'Pintura Teto Repintura', preco: 12.50, un: 'm¬≤', qtd: 55, total: 687.50 }
                    ],
                    total: 2600,
                    status: 'pendente',
                    data: new Date(hoje.getTime() - 5 * 24 * 60 * 60 * 1000).toISOString(),
                    val: 15
                },
                {
                    clienteId: 31,
                    titulo: 'Galeria de Arte',
                    itens: [
                        { servId: 52, nome: 'Drywall Massa Geral + 2 Acetinado', preco: 44.85, un: 'm¬≤', qtd: 180, total: 8073 },
                        { servId: 68, nome: 'Pintura Teto Selador + 2 dem√£os', preco: 18.00, un: 'm¬≤', qtd: 90, total: 1620 }
                    ],
                    total: 9693,
                    status: 'pendente',
                    data: new Date(hoje.getTime() - 4 * 24 * 60 * 60 * 1000).toISOString(),
                    val: 15
                },
                {
                    clienteId: 35,
                    titulo: 'Bar e Restaurante - Fachada',
                    itens: [
                        { servId: 58, nome: 'Pintura Fachada acima 3m', preco: 24.50, un: 'm¬≤', qtd: 75, total: 1837.50 },
                        { servId: 66, nome: 'Pintura Grade/Port√£o M', preco: 280.00, un: 'un', qtd: 2, total: 560 },
                        { servId: 15, nome: 'Lavagem Parede at√© 3m', preco: 4.54, un: 'm¬≤', qtd: 75, total: 340.50 }
                    ],
                    total: 2738,
                    status: 'pendente',
                    data: new Date(hoje.getTime() - 3 * 24 * 60 * 60 * 1000).toISOString(),
                    val: 15
                },
                {
                    clienteId: 38,
                    titulo: 'Escrit√≥rio Advocacia',
                    itens: [
                        { servId: 44, nome: 'Selador + 3 Massa + 2 Acr√≠lica Acetinado', preco: 48.28, un: 'm¬≤', qtd: 110, total: 5310.80 },
                        { servId: 69, nome: 'Pintura Teto com Massa', preco: 32.00, un: 'm¬≤', qtd: 55, total: 1760 },
                        { servId: 62, nome: 'Pintura Porta Frisada', preco: 120.00, un: 'un', qtd: 4, total: 480 }
                    ],
                    total: 7550.80,
                    status: 'recusado',
                    data: new Date(hoje.getTime() - 8 * 24 * 60 * 60 * 1000).toISOString(),
                    val: 15
                },
                {
                    clienteId: 40,
                    titulo: 'Sal√£o de Beleza - Reforma',
                    itens: [
                        { servId: 42, nome: 'Selador + Massa Acr√≠lica + 2 Acr√≠lica', preco: 28.50, un: 'm¬≤', qtd: 65, total: 1852.50 },
                        { servId: 67, nome: 'Pintura Teto Repintura', preco: 12.50, un: 'm¬≤', qtd: 35, total: 437.50 },
                        { servId: 61, nome: 'Pintura Porta Lisa', preco: 85.00, un: 'un', qtd: 3, total: 255 }
                    ],
                    total: 2545,
                    status: 'pendente',
                    data: new Date(hoje.getTime() - 1 * 24 * 60 * 60 * 1000).toISOString(),
                    val: 15
                },
                {
                    clienteId: 3,
                    titulo: 'Casa T√©rrea - Pintura Completa',
                    itens: [
                        { servId: 42, nome: 'Selador + Massa Acr√≠lica + 2 Acr√≠lica', preco: 28.50, un: 'm¬≤', qtd: 220, total: 6270 },
                        { servId: 69, nome: 'Pintura Teto com Massa', preco: 32.00, un: 'm¬≤', qtd: 95, total: 3040 },
                        { servId: 56, nome: 'Pintura Muro Externo', preco: 16.50, un: 'm¬≤', qtd: 65, total: 1072.50 },
                        { servId: 66, nome: 'Pintura Grade/Port√£o M', preco: 280.00, un: 'un', qtd: 1, total: 280 }
                    ],
                    total: 10662.50,
                    status: 'recusado',
                    data: new Date(hoje.getTime() - 12 * 24 * 60 * 60 * 1000).toISOString(),
                    val: 15
                }
            ];

            await db.orcamentos.bulkAdd(orcamentos);

            // PERFIL
            await db.perfil.add({
                nome: 'Painel Services',
                doc: '12.345.678/0001-99',
                tel: '(11) 99999-8888',
                email: 'contato@painelservices.com.br',
                end: 'S√£o Paulo - SP',
                val: 15
            });

            console.log('Database populado com sucesso!');
        }

        document.addEventListener('DOMContentLoaded', async () => {
            await seedDatabase();
            loadDashboard();
        });
    </script>
</body>
</html>
>>>>>>> a2e39e32ccbea0c1dca4c2c0595afcf2d66f85d8
